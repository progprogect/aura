# üîß –û—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

**–î–∞—Ç–∞:** 2025-10-12  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  

---

## üêõ –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### –û—à–∏–±–∫–∞:
```
Error: ENOENT: no such file or directory, open 'data:application/pdf;base64,'
```

### –ü—Ä–∏—á–∏–Ω–∞:
FormData –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å **–ø—É—Å—Ç–æ–π File –æ–±—ä–µ–∫—Ç** (`file.size === 0`), –∫–æ–≥–¥–∞ —Ñ–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞—Ç—å base64 –∏–∑ –ø—É—Å—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ `data:application/pdf;base64,` –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ Cloudinary.

### –ì–¥–µ –Ω–∞–π–¥–µ–Ω–æ:
1. `src/app/api/specialist/lead-magnets/route.ts` (POST) - **–ö–†–ò–¢–ò–ß–ù–û**
2. `src/app/api/specialist/gallery/route.ts` (POST) - **–ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–û**
3. `src/components/specialist/edit/LeadMagnetModal.tsx` - **–ö–õ–ò–ï–ù–¢**

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. API endpoint –¥–ª—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ (POST)

**–ë—ã–ª–æ (‚ùå –æ—à–∏–±–∫–∞):**
```typescript
if (file) {
  const bytes = await file.arrayBuffer()
  const buffer = Buffer.from(bytes)
  const base64 = `data:${file.type};base64,${buffer.toString('base64')}`
  // ... –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Cloudinary
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `file.size > 0`

**–°—Ç–∞–ª–æ (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**
```typescript
if (file && file.size > 0) {
  const bytes = await file.arrayBuffer()
  const buffer = Buffer.from(bytes)
  const base64 = `data:${file.type};base64,${buffer.toString('base64')}`
  // ... –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Cloudinary
}
```

**–§–∞–π–ª:** `src/app/api/specialist/lead-magnets/route.ts`  
**–°—Ç—Ä–æ–∫–∞:** 117

---

### 2. API endpoint –¥–ª—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ previewFile)

**–ë—ã–ª–æ (‚ùå –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞):**
```typescript
if (previewFile) {
  const bytes = await previewFile.arrayBuffer()
  // ...
}
```

**–°—Ç–∞–ª–æ (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**
```typescript
if (previewFile && previewFile.size > 0) {
  const bytes = await previewFile.arrayBuffer()
  // ...
}
```

**–§–∞–π–ª:** `src/app/api/specialist/lead-magnets/route.ts`  
**–°—Ç—Ä–æ–∫–∞:** 164

---

### 3. API endpoint –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏

**–ë—ã–ª–æ (‚ùå –Ω–µ–ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è):**
```typescript
if (!file) {
  return error
}

if (file.size > 10 * 1024 * 1024) {
  return error
}
```

**–°—Ç–∞–ª–æ (‚úÖ –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è):**
```typescript
if (!file) {
  return error
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
if (file.size === 0) {
  return NextResponse.json(
    { success: false, error: '–§–∞–π–ª –ø—É—Å—Ç–æ–π' },
    { status: 400 }
  )
}

if (file.size > 10 * 1024 * 1024) {
  return error
}
```

**–§–∞–π–ª:** `src/app/api/specialist/gallery/route.ts`  
**–°—Ç—Ä–æ–∫–∞:** 37-42

---

### 4. LeadMagnetModal (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è)

**–ë—ã–ª–æ (‚ùå —Ö–∞—Ä–¥–∫–æ–¥):**
```typescript
if (selectedFile.size > 10 * 1024 * 1024) {
  alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 10MB)')
}
```

**–°—Ç–∞–ª–æ (‚úÖ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ):**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
if (selectedFile.size === 0) {
  alert('–§–∞–π–ª –ø—É—Å—Ç–æ–π. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª')
  return
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
if (selectedFile.size > LEAD_MAGNET_LIMITS.MAX_FILE_SIZE) {
  const maxSizeMB = (LEAD_MAGNET_LIMITS.MAX_FILE_SIZE / 1024 / 1024).toFixed(0)
  alert(`–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å ${maxSizeMB}MB)`)
  return
}
```

**–§–∞–π–ª:** `src/components/specialist/edit/LeadMagnetModal.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 276-286

---

### 5. LeadMagnetModal (–æ—Ç–ø—Ä–∞–≤–∫–∞ FormData)

**–ë—ã–ª–æ (‚ùå –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç size):**
```typescript
const useFormData = (type === 'file' && file) || previewFile

if (type === 'file' && file) {
  formData.append('file', file)
}

if (previewFile) {
  formData.append('previewFile', previewFile)
}
```

**–°—Ç–∞–ª–æ (‚úÖ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç size):**
```typescript
const useFormData = (type === 'file' && file && file.size > 0) || (previewFile && previewFile.size > 0)

if (type === 'file' && file && file.size > 0) {
  formData.append('file', file)
}

if (previewFile && previewFile.size > 0) {
  formData.append('previewFile', previewFile)
}
```

**–§–∞–π–ª:** `src/components/specialist/edit/LeadMagnetModal.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 126, 142, 154

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **`file.size === 0`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª
2. **`file && file.size > 0`** - –¥–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
3. **`previewFile && previewFile.size > 0`** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –ø—Ä–µ–≤—å—é
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç** - –≤–º–µ—Å—Ç–æ magic numbers

### –ì–¥–µ –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:

‚úÖ **–ö–ª–∏–µ–Ω—Ç (LeadMagnetModal):**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π FormData
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

‚úÖ **–°–µ—Ä–≤–µ—Ä (API endpoints):**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `null`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `size === 0`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
- Graceful error handling

---

## üìä –ò—Ç–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

| –§–∞–π–ª | –ü—Ä–æ–±–ª–µ–º–∞ | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|------|----------|-------------|--------|
| `lead-magnets/route.ts` (POST) | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `file.size > 0` | –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚úÖ |
| `lead-magnets/route.ts` (preview) | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `previewFile.size > 0` | –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚úÖ |
| `gallery/route.ts` | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª | –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚úÖ |
| `LeadMagnetModal.tsx` (validation) | –•–∞—Ä–¥–∫–æ–¥ `10 * 1024 * 1024` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `LEAD_MAGNET_LIMITS` | ‚úÖ |
| `LeadMagnetModal.tsx` (FormData) | –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `size > 0` | –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ | ‚úÖ |
| `LeadMagnetModal.tsx` (emoji) | –•–∞—Ä–¥–∫–æ–¥ `'üéÅ'` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `DEFAULT_EMOJI` | ‚úÖ |

**–í—Å–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 6 –ø—Ä–æ–±–ª–µ–º** ‚úÖ

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

### –î—Ä—É–≥–∏–µ endpoints —Å FormData:

- ‚úÖ `avatar/route.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON body (–Ω–µ FormData –¥–ª—è —Ñ–∞–π–ª–æ–≤)
- ‚úÖ –ù–µ—Ç –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ FormData

### Edge cases –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã:

- ‚úÖ –§–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º 0 –±–∞–π—Ç ‚Üí –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω ‚Üí –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –§–∞–π–ª > MAX_SIZE ‚Üí –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π MIME type ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Cloudinary –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí graceful error

---

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è:
```bash
‚úì Compiled successfully
```

### –ù–µ—Ç linter errors:
```
No linter errors found.
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫:
‚úÖ –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π)  
‚úÖ –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏)  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤  
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç (–Ω–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞)  

---

## ‚ú® –ò—Ç–æ–≥

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**

‚úÖ –û—à–∏–±–∫–∞ `ENOENT: ...data:application/pdf;base64,` - **–ò–°–ü–†–ê–í–õ–ï–ù–ê**  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã - **–í–û –í–°–ï–• –º–µ—Å—Ç–∞—Ö**  
‚úÖ –£—Å—Ç—Ä–∞–Ω—ë–Ω —Ö–∞—Ä–¥–∫–æ–¥ - **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**  
‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è - **–ö–ª–∏–µ–Ω—Ç + –°–µ—Ä–≤–µ—Ä**  
‚úÖ –ü—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è - **–ë–µ–∑ –æ—à–∏–±–æ–∫**  

**–°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —Ç–µ–ø–µ—Ä—å –Ω–∞–¥—ë–∂–Ω–∞—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è!** üîí

