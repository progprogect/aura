# 🧪 Скрипты для тестирования AI чата

## 📋 Доступные скрипты:

### 1. **Автоматические тесты** (`test:chat`)
Запускает набор предопределенных UX-сценариев и проверяет работу чата.

```bash
npm run test:chat
```

**Что тестируется:**
- ✅ Полный цикл подбора психолога (все вопросы → кнопка → специалисты)
- ✅ Быстрый поиск фитнес-тренера (все параметры сразу)
- ✅ Уточнение после первой выдачи ("покажи еще")
- ✅ Расширение критериев при плохих результатах
- ✅ Диалог без кнопки поиска (GPT НЕ должен искать автоматически)

**Вывод:**
```
╔═══════════════════════════════════════════════╗
║   🧪 АВТОМАТИЧЕСКИЙ ТЕСТ AI ЧАТА              ║
║   Проверка UX-сценариев и логики работы       ║
╚═══════════════════════════════════════════════╝

📋 Сценарий: Полный цикл подбора психолога
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

👤 User: Помоги найти психолога
🤖 Assistant: Конечно! Давайте начнем...
🔘 Buttons: онлайн, офлайн, неважно

👤 User: онлайн
🤖 Assistant: Отлично! Какая у вас задача?
...

🧪 Проверка результатов:
✓ shouldSearch: да (факт: да)
✓ shouldHaveSpecialists: да (факт: да, найдено: 5)

✅ PASSED

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 ИТОГОВЫЙ ОТЧЕТ

✅ Passed: 5/5
❌ Failed: 0/5

Успешность: 100%

🎉 ВСЕ ТЕСТЫ ПРОШЛИ УСПЕШНО!
```

---

### 2. **Интерактивный чат** (`chat`)
Запускает AI чат прямо в терминале для быстрого тестирования.

```bash
npm run chat
```

**Возможности:**
- 💬 Общение с AI в терминале
- 👥 Отображение найденных специалистов
- 🔘 Показ быстрых кнопок
- `/reset` - очистить историю
- `/exit` - выход

**Вывод:**
```
╔═══════════════════════════════════════════════╗
║   💬 ИНТЕРАКТИВНЫЙ AI ЧАТ                     ║
║   Тестирование в терминале                    ║
╚═══════════════════════════════════════════════╝

👤 Вы: Помоги найти психолога
🤖 Ассистент: Конечно! Помогу подобрать психолога. 
              В каком формате вам удобно?

🔘 Быстрые ответы:
   1. онлайн
   2. офлайн
   3. неважно

👤 Вы: онлайн
🤖 Ассистент: Отлично! Какая у вас задача?
...

👥 Найдено специалистов: 5
   1. Анна Иванова
      psychology • Москва
      Категория: Психология и терапия
   2. Наталья Морозова
      psychology • Санкт-Петербург
      Категория: Психология и терапия

👤 Вы: /reset
История очищена ✓

👤 Вы: /exit
Пока! 👋
```

---

## 🚀 Как использовать:

### Локальное тестирование:
1. Запустите dev сервер: `npm run dev`
2. В новом терминале запустите тесты: `npm run test:chat`
3. Или интерактивный чат: `npm run chat`

### Тестирование на Railway:
1. Установите переменную окружения:
   ```bash
   export NEXT_PUBLIC_URL=https://ваш-проект.railway.app
   ```
2. Запустите тесты: `npm run test:chat`

---

## 📝 Добавление новых тестов:

Отредактируйте `scripts/test-chat.ts`, добавив новый сценарий в массив `SCENARIOS`:

```typescript
{
  name: 'Название теста',
  description: 'Описание что проверяем',
  messages: [
    'Первое сообщение',
    'Второе сообщение',
    '🔍 Найти специалистов'
  ],
  expectations: {
    shouldSearch: true,           // Должен ли запуститься поиск
    shouldHaveButtons: true,      // Должны ли быть кнопки
    shouldHaveSpecialists: true,  // Должны ли быть специалисты
    minMessages: 6,               // Минимальное кол-во сообщений
  }
}
```

---

## 🔧 Настройка:

По умолчанию используется `http://localhost:3000`. 

Для другого URL:
```bash
NEXT_PUBLIC_URL=https://your-app.railway.app npm run test:chat
```

Или добавьте в `.env.local`:
```
NEXT_PUBLIC_URL=http://localhost:3000
```

---

## 📊 Что проверяют тесты:

✅ **Логика поиска:**
- Поиск запускается ТОЛЬКО по кнопке или явному запросу
- НЕТ автоматического поиска без подтверждения

✅ **UX-поток:**
- GPT задает нужные вопросы
- Кнопки появляются в правильные моменты
- Специалисты показываются после запроса

✅ **Edge cases:**
- Расширение критериев при плохих результатах
- Повторные запросы ("покажи еще")
- Диалог без инициации поиска

---

## 🐛 Отладка:

Если тесты падают:

1. **Проверьте логи API:** `npm run dev` и смотрите консоль
2. **Проверьте переменные окружения:** `.env.local` должен содержать все ключи
3. **Проверьте MongoDB embeddings:** `npm run ai:generate-embeddings`
4. **Увеличьте timeout:** в `test-chat.ts` измените паузу между сценариями

---

## 💡 Советы:

- **Перед коммитом:** всегда запускайте `npm run test:chat`
- **Для быстрой проверки:** используйте `npm run chat`
- **CI/CD:** добавьте `npm run test:chat` в pre-push hook

---

Создано для быстрого и надежного тестирования AI чата! 🚀

