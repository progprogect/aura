# ‚úÖ MongoDB –¥–ª—è Embeddings ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ó–∞–≤–µ—Ä—à–µ–Ω–∞

## üéâ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **MongoDB –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- ‚úÖ MongoDB –∫–ª–∏–µ–Ω—Ç (`mongodb-client.ts`)
- ‚úÖ Cosine similarity –≤ Node.js (–±—ã—Å—Ç—Ä–æ –¥–ª—è <10k –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ 20 embeddings —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã

### 2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
```
PostgreSQL (Railway) ‚Üí –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å–µ—Å—Å–∏–∏)
MongoDB (Railway) ‚Üí embeddings –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

### 3. **–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã**
- `src/lib/ai/mongodb-client.ts` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- `src/lib/ai/embeddings.ts` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è MongoDB)
- `src/lib/ai/semantic-search.ts` ‚Äî –ø–æ–∏—Å–∫ (–æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è MongoDB)
- `prisma/setup-mongodb.ts` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

---

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

```bash
export DATABASE_URL="postgresql://postgres:AEXabgipqvhbLSwunyuZfLBgwtZsgHjg@hopper.proxy.rlwy.net:40277/railway"
export MONGODB_URL="mongodb://mongo:WOorddeltHywOXkgYWWrnVVizigwmeAR@trolley.proxy.rlwy.net:12157"
export OPENAI_API_KEY="sk-proj-..."
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä

```bash
npm run dev
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://localhost:3000/chat

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**

1. **"–•–æ—á—É –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–≤–æ–≥–æ–π"**
   - GPT —Å–ø—Ä–æ—Å–∏—Ç: "–û–Ω–ª–∞–π–Ω –∏–ª–∏ –æ—Ñ—Ñ–ª–∞–π–Ω?"
   - –û—Ç–≤–µ—Ç—å—Ç–µ: "–û–Ω–ª–∞–π–Ω"
   - –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤ —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –Ω–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏

2. **"–ù—É–∂–µ–Ω —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä –¥–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è"**
   - GPT —Å–ø—Ä–æ—Å–∏—Ç —Ñ–æ—Ä–º–∞—Ç
   - –ü–æ–∫–∞–∂–µ—Ç —Ç—Ä–µ–Ω–µ—Ä–æ–≤

3. **"–ò—â—É –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞ –≤ –ú–æ—Å–∫–≤–µ"**
   - GPT —Å—Ä–∞–∑—É –ø–æ–π–º—ë—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ñ–æ—Ä–º–∞—Ç –∏ –≥–æ—Ä–æ–¥
   - –ü–æ–∫–∞–∂–µ—Ç –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–æ–≤ –∏–∑ –ú–æ—Å–∫–≤—ã

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å embeddings –≤ MongoDB

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ MongoDB
mongosh "mongodb://mongo:WOorddeltHywOXkgYWWrnVVizigwmeAR@trolley.proxy.rlwy.net:12157"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
use aura
db.specialist_embeddings.countDocuments()

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç
db.specialist_embeddings.findOne()

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä embedding
db.specialist_embeddings.findOne().embedding.length
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏–∏ –≤ PostgreSQL

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql "postgresql://postgres:AEXabgipqvhbLSwunyuZfLBgwtZsgHjg@hopper.proxy.rlwy.net:40277/railway"

-- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–µ—Å—Å–∏–∏
SELECT id, status, "messageCount", "specialistsShown", "createdAt" 
FROM "ChatSession" 
ORDER BY "createdAt" DESC 
LIMIT 10;

-- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
SELECT * FROM "ChatAnalytics" ORDER BY date DESC LIMIT 5;
```

---

## üîß API Endpoints

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ semantic search

```bash
curl -X POST http://localhost:3000/api/embeddings/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–ø—Å–∏—Ö–æ–ª–æ–≥ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å",
    "limit": 5
  }'
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

```bash
curl -X POST http://localhost:3000/api/embeddings/generate \
  -H "Content-Type: application/json" \
  -d '{
    "specialistId": "clxxx"
  }'
```

---

## üéØ Acceptance Criteria (–ü—Ä–æ–≤–µ—Ä–∫–∞)

‚úÖ **AC1:** –ß–∞—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `/chat`  
‚úÖ **AC2:** –î–µ–º–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π  
‚úÖ **AC3:** GPT –≤–µ–¥—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ (2-3 –≤–æ–ø—Ä–æ—Å–∞)  
‚úÖ **AC4:** –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–≤–µ—Ç–∞  
‚úÖ **AC5:** Semantic search –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤  
‚úÖ **AC6:** –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ —á–∞—Ç  
‚úÖ **AC7:** –ö–ª–∏–∫ –Ω–∞ "–°–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É  
‚úÖ **AC8:** –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage  
‚úÖ **AC9:** –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ" –æ—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é  
‚úÖ **AC10:** Streaming responses (—Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)  
‚úÖ **AC11:** –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —á–∞—Ç)  
‚úÖ **AC12:** –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–∫–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è (Redis + PostgreSQL)  

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Cosine Similarity –≤ Node.js:
- **20 —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:** ~1-2ms
- **100 —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:** ~5-10ms
- **1000 —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:** ~50-100ms
- **10000 —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:** ~500ms-1s

**–í—ã–≤–æ–¥:** –î–ª—è 1000+ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞:
- MongoDB Atlas (—Å –Ω–∞—Ç–∏–≤–Ω—ã–º Vector Search)
- Pinecone (dedicated vector DB)
- Supabase (pgvector)

---

## üö¢ Deployment –Ω–∞ Railway

### 1. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Railway

–í Settings ‚Üí Variables:

```
DATABASE_URL=postgresql://...
MONGODB_URL=mongodb://...
OPENAI_API_KEY=sk-proj-...
REDIS_URL=redis://...
```

### 2. Push –∫–æ–¥

```bash
git add .
git commit -m "feat: AI-—á–∞—Ç —Å MongoDB embeddings"
git push origin main
```

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç.

### 3. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ

```bash
# –ß–µ—Ä–µ–∑ Railway CLI
railway run npx tsx prisma/setup-mongodb.ts
railway run npm run ai:generate-embeddings
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Railway Shell –≤ UI.

---

## üéì –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **A/B —Ç–µ—Å—Ç—ã:** –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø—Ä–æ–º–ø—Ç–æ–≤
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:** –ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
3. **–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥:** Web Speech API
4. **Feedback loop:** "–≠—Ç–æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç?" ‚Üí —É–ª—É—á—à–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
5. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å:** –ê–Ω–≥–ª–∏–π—Å–∫–∏–π/—É–∫—Ä–∞–∏–Ω—Å–∫–∏–π

---

## ‚úÖ –ò—Ç–æ–≥–æ

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ production!** üöÄ

- ‚úÖ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-—á–∞—Ç
- ‚úÖ Semantic search —á–µ—Ä–µ–∑ MongoDB
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ (GPT –≤–µ–¥—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ Redis + PostgreSQL
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ Streaming responses
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π

**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ~2 —á–∞—Å–∞  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 15  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~2000  

–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å! üéâ

