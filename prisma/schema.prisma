// Prisma schema –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// –ë–ê–ó–û–í–ê–Ø –ú–û–î–ï–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–¥–ª—è –≤—Å–µ—Ö)
// ========================================

model User {
  id String @id @default(cuid())

  // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—Å–µ—Ö)
  firstName String
  lastName  String
  phone     String  @unique
  email     String? @unique
  avatar    String?

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  specialistProfile SpecialistProfile?

  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ–¥–∏–Ω–∞—è –¥–ª—è –≤—Å–µ—Ö)
  authSessions   AuthSession[]
  socialAccounts SocialAccount[]

  // –ë–∞–ª–∞–Ω—Å—ã (—Å–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤)
  balance        Decimal   @default(0) @db.Decimal(15, 4)
  bonusBalance   Decimal   @default(0) @db.Decimal(15, 4)
  bonusExpiresAt DateTime?

  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞
  blocked      Boolean   @default(false)
  blockedAt    DateTime?
  blockedReason String?

  // –°–≤—è–∑–∏
  transactions        Transaction[]
  requests           UserRequest[]
  reviews            Review[]
  leadMagnetPurchases LeadMagnetPurchase[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([phone])
  @@index([email])
  @@index([blocked])
}

// ========================================
// –ü–†–û–§–ò–õ–¨ –°–ü–ï–¶–ò–ê–õ–ò–°–¢–ê (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ User)
// ========================================

model SpecialistProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  slug String @unique

  // –¢–∏–ø –ø—Ä–æ—Ñ–∏–ª—è
  profileType String @default("specialist") // "specialist" | "company"

  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
  category        String // "psychology" | "fitness" | "nutrition" | "massage" | "wellness" | "coaching" | "medicine" | "other"
  specializations String[] // –ì–∏–±–∫–∏–µ —Ç–µ–≥–∏: ["–ö–ü–¢-—Ç–µ—Ä–∞–ø–µ–≤—Ç", "–¢—Ä–µ–Ω–µ—Ä –ø–æ –π–æ–≥–µ", "–ù—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥"]

  // –ü–æ–ª—è –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π
  companyName         String? // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
  address             String? // –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å
  addressCoordinates  Json? // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã {lat: number, lng: number} –¥–ª—è –∫–∞—Ä—Ç—ã
  taxId               String? // –£–ù–ü/–ò–ù–ù

  // –û–ø–∏—Å–∞–Ω–∏–µ
  tagline String? // –ö—Ä–∞—Ç–∫–∏–π —Å–ª–æ–≥–∞–Ω (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
  about   String // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞

  // –õ–æ–∫–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã
  city        String?
  country     String   @default("–†–æ—Å—Å–∏—è")
  workFormats String[] // ["online", "offline", "hybrid"]

  // –û–ø—ã—Ç
  yearsOfPractice Int?

  // –ö–æ–Ω—Ç–∞–∫—Ç—ã (–ø—É–±–ª–∏—á–Ω—ã–µ)
  telegram  String?
  whatsapp  String?
  instagram String?
  website   String?

  // –°—Ç–æ–∏–º–æ—Å—Ç—å
  priceFrom        Int? // –¶–µ–Ω–∞ –æ—Ç (–≤ –∫–æ–ø–µ–π–∫–∞—Ö –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
  priceTo          Int? // –¶–µ–Ω–∞ –¥–æ
  currency         String  @default("RUB")
  priceDescription String? // "–∑–∞ —Å–µ—Å—Å–∏—é 60 –º–∏–Ω" –∏–ª–∏ "–∑–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É 3 –º–µ—Å—è—Ü–∞"

  // –ì–∏–±–∫–∏–µ –ø–æ–ª—è (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
  customFields Json?
  // –ü—Ä–∏–º–µ—Ä—ã:
  // psychology: { "methods": ["–ö–ü–¢", "–ú–∞–π–Ω–¥—Ñ—É–ª–Ω–µ—Å—å"], "worksWith": ["–¢—Ä–µ–≤–æ–≥–∞", "–î–µ–ø—Ä–µ—Å—Å–∏—è"], "sessionFormats": ["individual", "couples"], "sessionDuration": 60 }
  // fitness: { "trainingTypes": ["–°–∏–ª–æ–≤—ã–µ", "–ö—Ä–æ—Å—Å—Ñ–∏—Ç"], "sessionFormats": ["personal", "group"], "gymLocation": "FitnessPark, –ú–æ—Å–∫–≤–∞", "achievements": ["–ö–ú–° –ø–æ –ø–∞—É—ç—Ä–ª–∏—Ñ—Ç–∏–Ω–≥—É"] }
  // nutrition: { "approaches": ["–ö–ë–ñ–£", "–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ"], "specializations": ["–ü–æ—Ö—É–¥–µ–Ω–∏–µ", "–ù–∞–±–æ—Ä –º–∞—Å—Å—ã"], "programDuration": "1-3 –º–µ—Å—è—Ü–∞" }

  // –°–≤—è–∑–∏
  education            Education[]
  certificates         Certificate[]
  gallery              GalleryItem[]
  portfolio            PortfolioItem[]
  faqs                 FAQ[]
  leadMagnets          LeadMagnet[]
  consultationRequests ConsultationRequest[]
  services             Service[]
  orders               Order[]
  proposals            Proposal[]
  reviews              Review[]
  selectedRequests     UserRequest[]         @relation("SelectedSpecialistRequests")

  // –ú–µ–¥–∏–∞
  videoUrl String? // YouTube/Vimeo URL –¥–ª—è –≤–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏

  // –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å—Ç–∞—Ç—É—Å
  verified         Boolean   @default(false)
  verifiedAt       DateTime?
  acceptingClients Boolean   @default(true)

  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  blocked       Boolean   @default(false)
  blockedAt     DateTime?
  blockedReason String?

  // SEO
  metaTitle       String?
  metaDescription String?

  // –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è
  subscriptionTier String @default("FREE") // FREE, PREMIUM

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–∫–µ—à –∏–∑ Redis)
  profileViews Int @default(0)
  contactViews Int @default(0)

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ (–∫–µ—à)
  averageRating Float @default(0)
  totalReviews  Int   @default(0)

  // –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
  packagePurchases PackagePurchase[]

  // –ü–æ–∫—É–ø–∫–∏ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
  leadMagnetPurchases LeadMagnetPurchase[]

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–Ω—è–º)
  analyticsDaily SpecialistAnalyticsDaily[]

  // –û–Ω–±–æ—Ä–¥–∏–Ω–≥
  onboardingStep        Int?      @default(0)
  onboardingCompletedAt DateTime?
  onboardingSeenAt      DateTime? // –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑ —É–≤–∏–¥–µ–ª/–∑–∞–∫—Ä—ã–ª –æ–Ω–±–æ—Ä–¥–∏–Ω–≥

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([slug])
  @@index([category])
  @@index([verified])
  @@index([averageRating])
  @@index([totalReviews])
  @@index([blocked])
  @@index([profileType])
}

// ========================================
// –û–ë–†–ê–ó–û–í–ê–ù–ò–ï
// ========================================

model Education {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  institution String // –í–£–ó –∏–ª–∏ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ
  degree      String // –°—Ç–µ–ø–µ–Ω—å/—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
  year        Int // –ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è
  description String? // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –°–ï–†–¢–ò–§–ò–ö–ê–¢–´
// ========================================

model Certificate {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  title        String // –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
  organization String // –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –≤—ã–¥–∞–≤—à–∞—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
  year         Int // –ì–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è
  fileUrl      String? // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª/—Å–∫–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –ì–ê–õ–ï–†–ï–Ø (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
// ========================================

model GalleryItem {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  type         String // "photo" | "video"
  url          String // URL –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞
  thumbnailUrl String? // URL –ø—Ä–µ–≤—å—é (–¥–ª—è –≤–∏–¥–µ–æ)
  caption      String? // –ü–æ–¥–ø–∏—Å—å –∫ –º–µ–¥–∏–∞

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –ü–û–†–¢–§–û–õ–ò–û
// ========================================

model PortfolioItem {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  type         String // "photo" | "video"
  url          String // URL –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞
  thumbnailUrl String? // URL –ø—Ä–µ–≤—å—é (–¥–ª—è –≤–∏–¥–µ–æ)
  title        String // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–±–æ—Ç—ã
  description  String? // –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([specialistProfileId])
}

// ========================================
// FAQ
// ========================================

model FAQ {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  question String
  answer   String // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –õ–ò–î-–ú–ê–ì–ù–ò–¢–´
// ========================================

model LeadMagnet {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  type        String // "file" | "link" | "service"
  title       String // –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–∞
  description String // –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

  fileUrl String? // –î–ª—è —Ç–∏–ø–∞ "file" - URL —Ñ–∞–π–ª–∞ –≤ Cloudinary
  linkUrl String? // –î–ª—è —Ç–∏–ø–∞ "link" - –≤–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞

  emoji    String  @default("üéÅ")
  order    Int     @default(0)
  isActive Boolean @default(true)

  // SEO –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ UX)
  slug           String? // URL-friendly slug –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  highlights     String[] @default([]) // –°–ø–∏—Å–æ–∫ "–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏" (max 5 –ø—É–Ω–∫—Ç–æ–≤)
  targetAudience String? // "–î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤", "–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö" –∏ —Ç.–¥.
  fileSize       String? // "2.5 MB" - –¥–ª—è —Ñ–∞–π–ª–æ–≤
  ogImage        String? // –ö–µ—à Open Graph –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–ª—è —Å—Å—ã–ª–æ–∫)
  previewImage   String? // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (PNG/WebP) - DEPRECATED, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å previewUrls
  previewUrls    Json? // Responsive –ø—Ä–µ–≤—å—é URLs { thumbnail, card, detail, original }

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  viewCount     Int @default(0)
  downloadCount Int @default(0)

  // –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è
  priceInPoints Int? // null = –±–µ—Å–ø–ª–∞—Ç–Ω–æ, min: 1, max: 1000

  consultationRequests ConsultationRequest[]
  purchases            LeadMagnetPurchase[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([specialistProfileId, slug])
  @@index([specialistProfileId, isActive])
  @@index([slug])
}

// ========================================
// –ü–û–ö–£–ü–ö–ò –õ–ò–î-–ú–ê–ì–ù–ò–¢–û–í (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
// ========================================

model LeadMagnetPurchase {
  id String @id @default(cuid())

  leadMagnetId String
  leadMagnet   LeadMagnet @relation(fields: [leadMagnetId], references: [id], onDelete: Cascade)

  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  userId String
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏
  priceInPoints Int // –¶–µ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏
  pointsSpent   Decimal @db.Decimal(15, 2) // –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ (–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –∏–∑-–∑–∞ –±–æ–Ω—É—Å–æ–≤)

  // –°–≤—è–∑—å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
  transactionId String? @unique

  createdAt DateTime @default(now())

  // –ö–æ–º–∏—Å—Å–∏—è –∏ –∫–µ—à–±—ç–∫
  commissionProcessed Boolean @default(false)
  cashbackProcessed   Boolean @default(false)
  platformRevenueId  String?

  @@index([leadMagnetId])
  @@index([specialistProfileId])
  @@index([userId])
  @@index([createdAt])
}

// ========================================
// –ö–û–ú–ò–°–°–ò–ò –ò –ö–ï–®–ë–≠–ö –ü–õ–ê–¢–§–û–†–ú–´
// ========================================

model PlatformRevenue {
  id String @id @default(cuid())

  // –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
  type String // "commission" | "cashback_paid" | "refund"

  // –°–≤—è–∑—å —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π/–∑–∞–∫–∞–∑–æ–º
  transactionId        String?
  orderId              String?
  leadMagnetPurchaseId String?

  // –°—É–º–º—ã
  commissionAmount Decimal @db.Decimal(15, 4) // –ö–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (5%)
  cashbackAmount   Decimal @db.Decimal(15, 4) // –ö–µ—à–±—ç–∫ –∫–ª–∏–µ–Ω—Ç—É (2.5%)
  netRevenue       Decimal @db.Decimal(15, 4) // –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (2.5%)

  // –£—á–∞—Å—Ç–Ω–∏–∫–∏
  clientUserId     String // –ö—Ç–æ –∫—É–ø–∏–ª
  specialistUserId String? // –ö–æ–º—É –ø—Ä–æ–¥–∞–ª–∏ (null –¥–ª—è –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–≤ –±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞)

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  description String? // "–ö–æ–º–∏—Å—Å–∏—è –∑–∞ —É—Å–ª—É–≥—É: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"
  metadata    Json?   @db.JsonB // –î–æ–ø. –¥–∞–Ω–Ω—ã–µ

  // –°—Ç–∞—Ç—É—Å
  status String @default("completed") // "completed" | "refunded"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([clientUserId])
  @@index([specialistUserId])
  @@index([transactionId])
  @@index([orderId])
  @@index([leadMagnetPurchaseId])
  @@index([createdAt])
}

// ========================================
// –ó–ê–ü–†–û–°–´ –ù–ê –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Æ
// ========================================

model ConsultationRequest {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  // –õ–∏–¥-–º–∞–≥–Ω–∏—Ç (–µ—Å–ª–∏ –∑–∞—è–≤–∫–∞ —á–µ—Ä–µ–∑ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç)
  leadMagnetId String?
  leadMagnet   LeadMagnet? @relation(fields: [leadMagnetId], references: [id], onDelete: SetNull)

  // –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
  name    String
  contact String // Email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
  message String? // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

  // –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
  status String @default("new") // "new" | "contacted" | "scheduled" | "declined"

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([specialistProfileId])
  @@index([status])
  @@index([leadMagnetId])
}

// ========================================
// –ü–†–û–î–£–ö–¢–´/–£–°–õ–£–ì–ò –°–ü–ï–¶–ò–ê–õ–ò–°–¢–û–í
// ========================================

model Service {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  title       String // "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è", "–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫"
  description String @db.Text // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
  slug        String // URL-friendly slug

  // –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —É—Å–ª—É–≥—É
  highlights String[] @default([]) // ["60 –º–∏–Ω—É—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏", "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω"]

  // –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å—Ä–æ–∫–∏
  price        Int // –¶–µ–Ω–∞ –≤ –±–∞–ª–ª–∞—Ö (100 –±–∞–ª–ª–æ–≤ = 1 BYN –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  currency     String @default("BYN")
  deliveryDays Int? // –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (3, 7, 14 –¥–Ω–µ–π)

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  emoji    String  @default("üíº")
  order    Int     @default(0)
  isActive Boolean @default(true)

  // –°–≤—è–∑–∏
  orders Order[]

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  viewCount  Int @default(0)
  orderCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([specialistProfileId, slug])
  @@index([specialistProfileId, isActive])
  @@index([slug])
}

// ========================================
// –ó–ê–ö–ê–ó–´ –£–°–õ–£–ì
// ========================================

model Order {
  id        String  @id @default(cuid())
  serviceId String
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  // –°–≤—è–∑—å —Å –∑–∞—è–≤–∫–æ–π (–µ—Å–ª–∏ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –∏–∑ –∑–∞—è–≤–∫–∏)
  requestId String?      @unique
  request   UserRequest? @relation(fields: [requestId], references: [id], onDelete: SetNull)

  // –°–≤—è–∑—å —Å –æ—Ç–∑—ã–≤–æ–º
  review Review?

  // –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
  clientName    String
  clientContact String // –¢–µ–ª–µ—Ñ–æ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  clientMessage String? @db.Text // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  clientUserId  String? // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)

  // –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
  status String @default("pending")
  // pending - —Å–æ–∑–¥–∞–Ω, –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
  // paid - –æ–ø–ª–∞—á–µ–Ω, —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ —ç—Å–∫—Ä–æ—É
  // in_progress - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É
  // pending_completion - —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª, –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // completed - –∑–∞–≤–µ—Ä—à–µ–Ω–æ, —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã
  // cancelled - –æ—Ç–º–µ–Ω–µ–Ω (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤)
  // disputed - —Å–ø–æ—Ä (—ç—Å–∫–∞–ª–∞—Ü–∏—è)

  // –ü–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–∫–∞ NULL, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
  amountPaid    Decimal? @db.Decimal(15, 2) // –°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã
  paymentMethod String? // "balance" | "bonusBalance"
  transactionId String? // ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ Transaction –º–æ–¥–µ–ª–∏

  // –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤
  pointsUsed    Int       @default(0) // –°–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ
  pointsFrozen  Boolean   @default(false) // –ó–∞–º–æ—Ä–æ–∂–µ–Ω—ã –ª–∏ –±–∞–ª–ª—ã
  autoConfirmAt DateTime? // –ö–æ–≥–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (—á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π)

  // –≠—Å–∫—Ä–æ—É –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
  escrowReleased Boolean   @default(false) // –ü–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É
  deadline       DateTime? // –î–µ–¥–ª–∞–π–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  completedAt    DateTime? // –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

  // –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  resultScreenshot  String? // URL —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  resultDescription String?   @db.Text // –û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
  verifiedAt        DateTime? // –ö–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä–∏–ª –∞–¥–º–∏–Ω

  // Dispute resolution
  disputeReason String?   @db.Text // –ü—Ä–∏—á–∏–Ω–∞ —Å–ø–æ—Ä–∞
  disputedAt    DateTime? // –ö–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç —Å–ø–æ—Ä

  // –ö–æ–º–∏—Å—Å–∏—è –∏ –∫–µ—à–±—ç–∫
  commissionProcessed Boolean @default(false)
  cashbackProcessed   Boolean @default(false)
  platformRevenueId   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([specialistProfileId, status])
  @@index([serviceId])
  @@index([clientUserId])
  @@index([clientContact])
  @@index([status])
  @@index([deadline])
  @@index([requestId])
}

// ========================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô (–¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)
// ========================================

model Category {
  id         String  @id @default(cuid())
  key        String  @unique // "psychology", "fitness", "nutrition"
  name       String // "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –∏ —Ç–µ—Ä–∞–ø–∏—è"
  emoji      String // "üß†"
  priceLabel String // "–∑–∞ —Å–µ—Å—Å–∏—é"
  order      Int     @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  isActive   Boolean @default(true) // –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è

  fields CategoryField[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@index([isActive])
}

model CategoryField {
  id         String   @id @default(cuid())
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  key   String // "methods", "worksWith"
  label String // "–ú–µ—Ç–æ–¥—ã"
  icon  String // "üß†"
  type  String // "array", "string", "number", "boolean"

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—è
  required    Boolean @default(false) // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ª–∏ –ø–æ–ª–µ
  placeholder String? // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è input
  helpText    String? // –ü–æ–¥—Å–∫–∞–∑–∫–∞

  order    Int     @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  isActive Boolean @default(true) // –ê–∫—Ç–∏–≤–Ω–æ –ª–∏ –ø–æ–ª–µ

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([categoryId, key])
  @@index([categoryId])
  @@index([isActive])
}

// ========================================
// AI-–ß–ê–¢: EMBEDDINGS —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ MongoDB
// ========================================
// –°–º. src/lib/ai/mongodb-client.ts

// ========================================
// –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò (–µ–¥–∏–Ω–∞—è –¥–ª—è –≤—Å–µ—Ö)
// ========================================

model AuthSession {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
  sessionToken      String  @unique
  deviceFingerprint String?
  userAgent         String?
  ipAddress         String?

  // –°—Ç–∞—Ç—É—Å –∏ –≤—Ä–µ–º—è
  isActive   Boolean  @default(true)
  expiresAt  DateTime
  lastUsedAt DateTime @default(now())

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([sessionToken])
  @@index([expiresAt])
}

model SocialAccount {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –î–∞–Ω–Ω—ã–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
  provider   String // "google" | "vk" | "yandex" | "whatsapp" | "telegram"
  providerId String // ID –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  email      String?
  name       String?
  picture    String?
  rawData    Json? // –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

  // –°—Ç–∞—Ç—É—Å
  isPrimary  Boolean @default(false)
  isVerified Boolean @default(false)

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerId])
  @@index([userId])
  @@index([provider])
}

model SMSVerification {
  id String @id @default(cuid())

  // –î–∞–Ω–Ω—ã–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
  phone   String
  code    String
  purpose String // "registration" | "login" | "recovery"

  // –°—Ç–∞—Ç—É—Å –∏ –≤—Ä–µ–º—è
  isUsed    Boolean  @default(false)
  attempts  Int      @default(0)
  expiresAt DateTime

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime  @default(now())
  usedAt    DateTime?

  @@index([phone])
  @@index([code])
  @@index([expiresAt])
}

// ========================================
// AI-–ß–∞—Ç: –°–ï–°–°–ò–ò –ò –ò–°–¢–û–†–ò–Ø
// ========================================

model ChatSession {
  id String @id @default(cuid())

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–¥–ª—è –±—É–¥—É—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
  userId String?

  // –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
  messages Json @db.JsonB
  // –§–æ—Ä–º–∞—Ç: [{id, role: 'user'|'assistant', content, specialists?: [], timestamp}]

  // –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ (–∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
  extractedFilters Json? @db.JsonB
  // –§–æ—Ä–º–∞—Ç: {category, workFormats, city, minExperience, maxPrice, problem, preferences}

  // IDs –ø–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (–¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  recommendedIds String[]

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  status String @default("active") // "active" | "completed" | "abandoned"
  source String @default("chat_page") // "chat_page" | "homepage" | "catalog"

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  messageCount     Int      @default(0)
  specialistsShown Int      @default(0)
  clickedProfiles  String[] @default([])

  // TTL: —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  expiresAt DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  @@index([createdAt])
}

// ========================================
// –ê–ù–ê–õ–ò–¢–ò–ö–ê –ß–ê–¢–ê (Redis + aggregation)
// ========================================

model ChatAnalytics {
  id String @id @default(cuid())

  // –í—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–¥–µ–Ω—å/—á–∞—Å)
  date DateTime @db.Date
  hour Int? // –ß–∞—Å –¥–Ω—è (0-23), null = –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞ –¥–µ–Ω—å

  // –ú–µ—Ç—Ä–∏–∫–∏
  sessionsStarted Int @default(0)
  messagesTotal   Int @default(0)
  completedChats  Int @default(0) // –î–æ—à–ª–∏ –¥–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
  abandonedChats  Int @default(0)

  profileClicks Int @default(0) // –ü–µ—Ä–µ—Ö–æ–¥—ã –∫ –ø—Ä–æ—Ñ–∏–ª—é
  catalogClicks Int @default(0) // "–û—Ç–∫—Ä—ã—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ"

  avgMessagesPerSession Float @default(0)
  avgSpecialistsShown   Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([date, hour])
  @@index([date])
}

// ========================================
// –ê–ù–ê–õ–ò–¢–ò–ö–ê –°–ü–ï–¶–ò–ê–õ–ò–°–¢–û–í (–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–Ω—è–º)
// ========================================

model SpecialistAnalyticsDaily {
  id           String   @id @default(cuid())
  specialistId String
  specialistProfile SpecialistProfile @relation(fields: [specialistId], references: [id], onDelete: Cascade)
  
  date         DateTime @db.Date
  
  // –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞ –¥–µ–Ω—å
  profileViews      Int @default(0)
  contactViews      Int @default(0)
  consultationRequests Int @default(0)
  orders            Int @default(0)
  reviews           Int @default(0)
  
  // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (JSON) - { catalog: 60, search: 30, direct: 10 }
  sources Json? @db.JsonB
  
  // –ö–æ–Ω–≤–µ—Ä—Å–∏–∏
  conversionRateProfileToContact Float @default(0) // %
  conversionRateContactToRequest Float @default(0) // %
  conversionRateRequestToOrder   Float @default(0) // %
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@unique([specialistId, date])
  @@index([specialistId, date])
  @@index([date])
}

// ========================================
// –°–ò–°–¢–ï–ú–ê –ë–ê–õ–õ–û–í (–í–ù–£–¢–†–ï–ù–ù–Ø–Ø –í–ê–õ–Æ–¢–ê)
// ========================================

model Transaction {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type        String // "bonus_registration", "purchase", "withdrawal", "bonus_expired", "bonus_reward", "deposit", "refund"
  amount      Decimal @db.Decimal(15, 4)
  balanceType String // "balance" | "bonusBalance"

  balanceBefore Decimal @db.Decimal(15, 4)
  balanceAfter  Decimal @db.Decimal(15, 4)

  description String? // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
  metadata    Json?   @db.JsonB // –î–æ–ø. –¥–∞–Ω–Ω—ã–µ: { leadMagnetId, productId, etc }

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

model Currency {
  id   String @id @default(cuid())
  code String @unique // "BYN", "RUB", "USD", "EUR"
  name String // "–ë–µ–ª–æ—Ä—É—Å—Å–∫–∏–π —Ä—É–±–ª—å"

  rateToPoints Decimal @db.Decimal(10, 4) // 1 BYN = X –±–∞–ª–ª–æ–≤ (–ø–æ–∫–∞ 1:1)

  isActive  Boolean @default(true)
  isDefault Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([code])
  @@index([isActive])
}

// ========================================
// –ü–û–ö–£–ü–ö–ò –ü–ê–ö–ï–¢–û–í –°–ü–ï–¶–ò–ê–õ–ò–°–¢–ê–ú–ò
// ========================================

model PackagePurchase {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  packageId   String // 'basic', 'standard', 'premium'
  pointsSpent Int // –°–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ

  createdAt DateTime @default(now())

  @@index([specialistProfileId])
  @@index([createdAt])
  @@index([packageId])
}

// ========================================
// –°–ò–°–¢–ï–ú–ê –ó–ê–Ø–í–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
// ========================================

model UserRequest {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  title       String // "–ù—É–∂–µ–Ω –ø—Å–∏—Ö–æ–ª–æ–≥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–≤–æ–≥–æ–π"
  description String @db.Text // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
  category    String // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∑–∞—è–≤–∫–∏ (key –∏–∑ Category)

  // –ë—é–¥–∂–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  budget Int? // –ë—é–¥–∂–µ—Ç –≤ –±–∞–ª–ª–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, min 50, max 2000)

  // –°—Ç–∞—Ç—É—Å
  status String @default("open")
  // "open" | "in_progress" | "completed" | "cancelled"

  // –í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω)
  selectedSpecialistId String?
  selectedSpecialist   SpecialistProfile? @relation("SelectedSpecialistRequests", fields: [selectedSpecialistId], references: [id], onDelete: SetNull)

  // –°–≤—è–∑–∏
  proposals Proposal[] // –û—Ç–∫–ª–∏–∫–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤

  // –ó–∞–∫–∞–∑ (—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –æ—Ç–∫–ª–∏–∫–∞)
  orderId String? @unique
  order   Order?

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  closedAt  DateTime? // –ö–æ–≥–¥–∞ –∑–∞–∫—Ä—ã—Ç/–æ—Ç–º–µ–Ω—ë–Ω

  @@index([userId])
  @@index([category])
  @@index([status])
  @@index([createdAt])
}

// ========================================
// –û–¢–ö–õ–ò–ö–ò –°–ü–ï–¶–ò–ê–õ–ò–°–¢–û–í (Proposals)
// ========================================

model Proposal {
  id        String      @id @default(cuid())
  requestId String
  request   UserRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)

  specialistId String
  specialist   SpecialistProfile @relation(fields: [specialistId], references: [id], onDelete: Cascade)

  // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  message       String @db.Text // –ü–æ—á–µ–º—É –ø–æ–¥—Ö–æ–∂—É (min 50, max 1000)
  proposedPrice Int // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ –≤ –±–∞–ª–ª–∞—Ö (min 50, max 2000)

  // –°—Ç–∞—Ç—É—Å
  status String @default("pending")
  // "pending" | "accepted" | "rejected" | "withdrawn" | "expired"

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  acceptedAt  DateTime? // –ö–æ–≥–¥–∞ –ø—Ä–∏–Ω—è—Ç
  rejectedAt  DateTime? // –ö–æ–≥–¥–∞ –æ—Ç–∫–ª–æ–Ω—ë–Ω
  withdrawnAt DateTime? // –ö–æ–≥–¥–∞ –æ—Ç–æ–∑–≤–∞–Ω

  @@unique([requestId, specialistId]) // –û–¥–∏–Ω –æ—Ç–∫–ª–∏–∫ –Ω–∞ –∑–∞—è–≤–∫—É –æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  @@index([specialistId])
  @@index([requestId])
  @@index([status])
  @@index([createdAt])
}

// ========================================
// –û–¢–ó–´–í–´ (Reviews)
// ========================================

model Review {
  id      String @id @default(cuid())
  orderId String @unique // –û–¥–∏–Ω –æ—Ç–∑—ã–≤ –Ω–∞ –∑–∞–∫–∞–∑
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  specialistId String
  specialist   SpecialistProfile @relation(fields: [specialistId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  rating  Int // 1-5 –∑–≤—ë–∑–¥
  comment String? @db.Text // –û—Ç–∑—ã–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([specialistId])
  @@index([userId])
  @@index([rating])
}

// ========================================
// –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†
// ========================================

model Admin {
  id           String        @id @default(cuid())
  username     String        @unique
  passwordHash String
  sessions     AdminSession[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([username])
}

model AdminSession {
  id           String   @id @default(cuid())
  adminId      String
  admin        Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  sessionToken String   @unique
  userAgent    String?
  ipAddress    String?

  isActive  Boolean  @default(true)
  expiresAt DateTime
  lastUsedAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([adminId])
  @@index([sessionToken])
  @@index([expiresAt])
}
