// Prisma schema –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// –ë–ê–ó–û–í–ê–Ø –ú–û–î–ï–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–¥–ª—è –≤—Å–µ—Ö)
// ========================================

model User {
  id String @id @default(cuid())

  // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤—Å–µ—Ö)
  firstName String
  lastName  String
  phone     String  @unique
  email     String? @unique
  avatar    String?

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
  specialistProfile SpecialistProfile?

  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ–¥–∏–Ω–∞—è –¥–ª—è –≤—Å–µ—Ö)
  authSessions   AuthSession[]
  socialAccounts SocialAccount[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([phone])
  @@index([email])
}

// ========================================
// –ü–†–û–§–ò–õ–¨ –°–ü–ï–¶–ò–ê–õ–ò–°–¢–ê (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ User)
// ========================================

model SpecialistProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  slug String @unique

  // –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
  category        String // "psychology" | "fitness" | "nutrition" | "massage" | "wellness" | "coaching" | "medicine" | "other"
  specializations String[] // –ì–∏–±–∫–∏–µ —Ç–µ–≥–∏: ["–ö–ü–¢-—Ç–µ—Ä–∞–ø–µ–≤—Ç", "–¢—Ä–µ–Ω–µ—Ä –ø–æ –π–æ–≥–µ", "–ù—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥"]

  // –û–ø–∏—Å–∞–Ω–∏–µ
  tagline String? // –ö—Ä–∞—Ç–∫–∏–π —Å–ª–æ–≥–∞–Ω (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
  about   String // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞

  // –õ–æ–∫–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã
  city        String?
  country     String   @default("–†–æ—Å—Å–∏—è")
  workFormats String[] // ["online", "offline", "hybrid"]

  // –û–ø—ã—Ç
  yearsOfPractice Int?

  // –ö–æ–Ω—Ç–∞–∫—Ç—ã (–ø—É–±–ª–∏—á–Ω—ã–µ)
  telegram  String?
  whatsapp  String?
  instagram String?
  website   String?

  // –°—Ç–æ–∏–º–æ—Å—Ç—å
  priceFrom        Int? // –¶–µ–Ω–∞ –æ—Ç (–≤ –∫–æ–ø–µ–π–∫–∞—Ö –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏)
  priceTo          Int? // –¶–µ–Ω–∞ –¥–æ
  currency         String  @default("RUB")
  priceDescription String? // "–∑–∞ —Å–µ—Å—Å–∏—é 60 –º–∏–Ω" –∏–ª–∏ "–∑–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É 3 –º–µ—Å—è—Ü–∞"

  // –ì–∏–±–∫–∏–µ –ø–æ–ª—è (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
  customFields Json?
  // –ü—Ä–∏–º–µ—Ä—ã:
  // psychology: { "methods": ["–ö–ü–¢", "–ú–∞–π–Ω–¥—Ñ—É–ª–Ω–µ—Å—å"], "worksWith": ["–¢—Ä–µ–≤–æ–≥–∞", "–î–µ–ø—Ä–µ—Å—Å–∏—è"], "sessionFormats": ["individual", "couples"], "sessionDuration": 60 }
  // fitness: { "trainingTypes": ["–°–∏–ª–æ–≤—ã–µ", "–ö—Ä–æ—Å—Å—Ñ–∏—Ç"], "sessionFormats": ["personal", "group"], "gymLocation": "FitnessPark, –ú–æ—Å–∫–≤–∞", "achievements": ["–ö–ú–° –ø–æ –ø–∞—É—ç—Ä–ª–∏—Ñ—Ç–∏–Ω–≥—É"] }
  // nutrition: { "approaches": ["–ö–ë–ñ–£", "–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ"], "specializations": ["–ü–æ—Ö—É–¥–µ–Ω–∏–µ", "–ù–∞–±–æ—Ä –º–∞—Å—Å—ã"], "programDuration": "1-3 –º–µ—Å—è—Ü–∞" }

  // –°–≤—è–∑–∏
  education            Education[]
  certificates         Certificate[]
  gallery              GalleryItem[]
  faqs                 FAQ[]
  leadMagnets          LeadMagnet[]
  consultationRequests ConsultationRequest[]

  // –ú–µ–¥–∏–∞
  videoUrl String? // YouTube/Vimeo URL –¥–ª—è –≤–∏–¥–µ–æ-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏

  // –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å—Ç–∞—Ç—É—Å
  verified         Boolean   @default(false)
  verifiedAt       DateTime?
  acceptingClients Boolean   @default(true)

  // SEO
  metaTitle       String?
  metaDescription String?

  // –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è
  subscriptionTier String @default("FREE") // FREE, PREMIUM

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–∫–µ—à –∏–∑ Redis)
  profileViews Int @default(0)
  contactViews Int @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([slug])
  @@index([category])
  @@index([verified])
}

// ========================================
// –û–ë–†–ê–ó–û–í–ê–ù–ò–ï
// ========================================

model Education {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  institution String // –í–£–ó –∏–ª–∏ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ
  degree      String // –°—Ç–µ–ø–µ–Ω—å/—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å
  year        Int // –ì–æ–¥ –æ–∫–æ–Ω—á–∞–Ω–∏—è
  description String? // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –°–ï–†–¢–ò–§–ò–ö–ê–¢–´
// ========================================

model Certificate {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  title        String // –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
  organization String // –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –≤—ã–¥–∞–≤—à–∞—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
  year         Int // –ì–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è
  fileUrl      String? // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª/—Å–∫–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –ì–ê–õ–ï–†–ï–Ø (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
// ========================================

model GalleryItem {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  type         String // "photo" | "video"
  url          String // URL –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞
  thumbnailUrl String? // URL –ø—Ä–µ–≤—å—é (–¥–ª—è –≤–∏–¥–µ–æ)
  caption      String? // –ü–æ–¥–ø–∏—Å—å –∫ –º–µ–¥–∏–∞

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// FAQ
// ========================================

model FAQ {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  question String
  answer   String // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Markdown

  order     Int      @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt DateTime @default(now())

  @@index([specialistProfileId])
}

// ========================================
// –õ–ò–î-–ú–ê–ì–ù–ò–¢–´
// ========================================

model LeadMagnet {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  type        String // "file" | "link" | "service"
  title       String // –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–∞
  description String // –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

  fileUrl String? // –î–ª—è —Ç–∏–ø–∞ "file" - URL —Ñ–∞–π–ª–∞ –≤ Cloudinary
  linkUrl String? // –î–ª—è —Ç–∏–ø–∞ "link" - –≤–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞

  emoji    String  @default("üéÅ")
  order    Int     @default(0)
  isActive Boolean @default(true)

  // SEO –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ UX)
  slug           String?   // URL-friendly slug –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  highlights     String[]  @default([]) // –°–ø–∏—Å–æ–∫ "–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏" (max 5 –ø—É–Ω–∫—Ç–æ–≤)
  targetAudience String?   // "–î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤", "–î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö" –∏ —Ç.–¥.
  fileSize       String?   // "2.5 MB" - –¥–ª—è —Ñ–∞–π–ª–æ–≤
  ogImage        String?   // –ö–µ—à Open Graph –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–ª—è —Å—Å—ã–ª–æ–∫)
  previewImage   String?   // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–≤—å—é –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (PNG/WebP) - DEPRECATED, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å previewUrls
  previewUrls    Json?     // Responsive –ø—Ä–µ–≤—å—é URLs { thumbnail, card, detail, original }

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  viewCount     Int @default(0)
  downloadCount Int @default(0)

  consultationRequests ConsultationRequest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([specialistProfileId, slug])
  @@index([specialistProfileId, isActive])
  @@index([slug])
}

// ========================================
// –ó–ê–ü–†–û–°–´ –ù–ê –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Æ
// ========================================

model ConsultationRequest {
  id                  String            @id @default(cuid())
  specialistProfileId String
  specialistProfile   SpecialistProfile @relation(fields: [specialistProfileId], references: [id], onDelete: Cascade)

  // –õ–∏–¥-–º–∞–≥–Ω–∏—Ç (–µ—Å–ª–∏ –∑–∞—è–≤–∫–∞ —á–µ—Ä–µ–∑ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç)
  leadMagnetId String?
  leadMagnet   LeadMagnet? @relation(fields: [leadMagnetId], references: [id], onDelete: SetNull)

  // –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
  name    String
  contact String // Email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω
  message String? // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

  // –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
  status String @default("new") // "new" | "contacted" | "scheduled" | "declined"

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([specialistProfileId])
  @@index([status])
  @@index([leadMagnetId])
}

// ========================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô (–¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)
// ========================================

model Category {
  id         String  @id @default(cuid())
  key        String  @unique // "psychology", "fitness", "nutrition"
  name       String // "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –∏ —Ç–µ—Ä–∞–ø–∏—è"
  emoji      String // "üß†"
  priceLabel String // "–∑–∞ —Å–µ—Å—Å–∏—é"
  order      Int     @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  isActive   Boolean @default(true) // –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è

  fields CategoryField[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([key])
  @@index([isActive])
}

model CategoryField {
  id         String   @id @default(cuid())
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  key   String // "methods", "worksWith"
  label String // "–ú–µ—Ç–æ–¥—ã"
  icon  String // "üß†"
  type  String // "array", "string", "number", "boolean"

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—è
  required    Boolean @default(false) // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ª–∏ –ø–æ–ª–µ
  placeholder String? // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è input
  helpText    String? // –ü–æ–¥—Å–∫–∞–∑–∫–∞

  order    Int     @default(0) // –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  isActive Boolean @default(true) // –ê–∫—Ç–∏–≤–Ω–æ –ª–∏ –ø–æ–ª–µ

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([categoryId, key])
  @@index([categoryId])
  @@index([isActive])
}

// ========================================
// AI-–ß–ê–¢: EMBEDDINGS —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ MongoDB
// ========================================
// –°–º. src/lib/ai/mongodb-client.ts

// ========================================
// –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò (–µ–¥–∏–Ω–∞—è –¥–ª—è –≤—Å–µ—Ö)
// ========================================

model AuthSession {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
  sessionToken      String  @unique
  deviceFingerprint String?
  userAgent         String?
  ipAddress         String?

  // –°—Ç–∞—Ç—É—Å –∏ –≤—Ä–µ–º—è
  isActive   Boolean  @default(true)
  expiresAt  DateTime
  lastUsedAt DateTime @default(now())

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([sessionToken])
  @@index([expiresAt])
}

model SocialAccount {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // –î–∞–Ω–Ω—ã–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
  provider   String // "google" | "vk" | "yandex" | "whatsapp" | "telegram"
  providerId String // ID –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  email      String?
  name       String?
  picture    String?
  rawData    Json? // –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

  // –°—Ç–∞—Ç—É—Å
  isPrimary  Boolean @default(false)
  isVerified Boolean @default(false)

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerId])
  @@index([userId])
  @@index([provider])
}

model SMSVerification {
  id String @id @default(cuid())

  // –î–∞–Ω–Ω—ã–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
  phone   String
  code    String
  purpose String // "registration" | "login" | "recovery"

  // –°—Ç–∞—Ç—É—Å –∏ –≤—Ä–µ–º—è
  isUsed    Boolean  @default(false)
  attempts  Int      @default(0)
  expiresAt DateTime

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt DateTime  @default(now())
  usedAt    DateTime?

  @@index([phone])
  @@index([code])
  @@index([expiresAt])
}

// ========================================
// AI-–ß–∞—Ç: –°–ï–°–°–ò–ò –ò –ò–°–¢–û–†–ò–Ø
// ========================================

model ChatSession {
  id String @id @default(cuid())

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–¥–ª—è –±—É–¥—É—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
  userId String?

  // –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
  messages Json @db.JsonB
  // –§–æ—Ä–º–∞—Ç: [{id, role: 'user'|'assistant', content, specialists?: [], timestamp}]

  // –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ (–∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
  extractedFilters Json? @db.JsonB
  // –§–æ—Ä–º–∞—Ç: {category, workFormats, city, minExperience, maxPrice, problem, preferences}

  // IDs –ø–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (–¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  recommendedIds String[]

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  status String @default("active") // "active" | "completed" | "abandoned"
  source String @default("chat_page") // "chat_page" | "homepage" | "catalog"

  // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
  messageCount     Int      @default(0)
  specialistsShown Int      @default(0)
  clickedProfiles  String[] @default([])

  // TTL: —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  expiresAt DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  @@index([createdAt])
}

// ========================================
// –ê–ù–ê–õ–ò–¢–ò–ö–ê –ß–ê–¢–ê (Redis + aggregation)
// ========================================

model ChatAnalytics {
  id String @id @default(cuid())

  // –í—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (–¥–µ–Ω—å/—á–∞—Å)
  date DateTime @db.Date
  hour Int? // –ß–∞—Å –¥–Ω—è (0-23), null = –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞ –¥–µ–Ω—å

  // –ú–µ—Ç—Ä–∏–∫–∏
  sessionsStarted Int @default(0)
  messagesTotal   Int @default(0)
  completedChats  Int @default(0) // –î–æ—à–ª–∏ –¥–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
  abandonedChats  Int @default(0)

  profileClicks Int @default(0) // –ü–µ—Ä–µ—Ö–æ–¥—ã –∫ –ø—Ä–æ—Ñ–∏–ª—é
  catalogClicks Int @default(0) // "–û—Ç–∫—Ä—ã—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ"

  avgMessagesPerSession Float @default(0)
  avgSpecialistsShown   Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([date, hour])
  @@index([date])
}
