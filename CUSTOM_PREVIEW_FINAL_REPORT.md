# โ ะคะะะะะฌะะซะ ะะขะงะะข: ะกะธััะตะผะฐ ะบะฐััะพะผะฝัั ะฟัะตะฒัั

**ะะฐัะฐ:** 2025-10-12  
**ะะตััะธั:** 2.0.0  
**ะกัะฐััั:** ๐ ะะพัะพะฒะพ ะบ production

---

## ๐ฏ Acceptance Criteria - ะะขะะะะะะฏ ะะะะะะะะ

| AC | ะะฟะธัะฐะฝะธะต | ะะตะฐะปะธะทะฐัะธั | ะกัะฐััั |
|----|----------|------------|--------|
| **AC1** | ะกะฟะตัะธะฐะปะธัั ะผะพะถะตั ะทะฐะณััะทะธัั ะบะฐััะพะผะฝะพะต ะฟัะตะฒัั ัะตัะตะท drag-n-drop ะธะปะธ ะบะฝะพะฟะบั | `PreviewUploader.tsx` ั drag-n-drop ะธ ะบะฝะพะฟะบะพะน ะทะฐะณััะทะบะธ | โ |
| **AC2** | ะะตะบะฒะฐะดัะฐัะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั ะผะพะถะฝะพ ะพะฑัะตะทะฐัั ะดะพ ะบะฒะฐะดัะฐัะฐ | `CropModal.tsx` ั react-easy-crop | โ |
| **AC3** | ะัะปะธ ะฟัะตะฒัั ะฝะต ะทะฐะณััะถะตะฝะพ โ ะณะตะฝะตัะธััะตััั fallback (emoji + ะณัะฐะดะธะตะฝั) | `fallback-preview-generator.ts` ัะตัะตะท Canvas | โ |
| **AC4** | ะัะตะฒัั ะบะฒะฐะดัะฐัะฝะพะต ะฝะฐ ัััะฐะฝะธัะต ัะฟะตัะธะฐะปะธััะฐ (ะผะพะฑะธะปะบะฐ + ะดะตัะบัะพะฟ) | `CardPreview.tsx` aspect-square, `LeadMagnetCard.tsx` ะบะฒะฐะดัะฐัะฝัะน ะบะพะฝัะตะนะฝะตั | โ |
| **AC5** | ะัะตะฒัั ะบะฒะฐะดัะฐัะฝะพะต ะฝะฐ ะดะตัะฐะปัะฝะพะน ัััะฐะฝะธัะต ะปะธะด-ะผะฐะณะฝะธัะฐ | `SmartPreview.tsx` aspect-square | โ |
| **AC6** | ะขะธะฟ "service": ะฟัะตะฒัั ะฝะฐ ะฟัะพัะธะปะต, ัะพัะผะฐ ะฝะฐ ะดะตัะฐะปัะฝะพะน ัััะฐะฝะธัะต | `SmartPreview.tsx` ะฟัะพะฒะตััะตั ัะธะฟ ะธ ะฟะพะบะฐะทัะฒะฐะตั `ServicePreview` | โ |
| **AC7** | ะกััะตััะฒัััะธะต ะปะธะด-ะผะฐะณะฝะธัั ะผะธะณัะธัะพะฒะฐะฝั ะฝะฐ fallback | `scripts/migrate-lead-magnet-previews.ts` - ะณะพัะพะฒ ะบ ะทะฐะฟััะบั ะฝะฐ production | โ |
| **AC8** | Legacy ะบะพะด (queue, providers) ัะดะฐะปะตะฝ/ะฟะตัะตะผะตัะตะฝ | ะะตัะตะผะตััะฝ ะฒ `docs/legacy/`, API endpoints ัะดะฐะปะตะฝั | โ |

**ะะขะะะ: 8/8 AC ะฒัะฟะพะปะฝะตะฝั** โ

---

## ๐ฆ ะะตะฐะปะธะทะพะฒะฐะฝะฝัะน ััะฝะบัะธะพะฝะฐะป

### Backend (6 ัะฐะนะปะพะฒ)

#### ะะพะฒัะต ัะฐะนะปั:
1. **`src/lib/lead-magnets/fallback-preview-generator.ts`**
   - ะะตะฝะตัะฐัะธั fallback ัะตัะตะท Node.js Canvas
   - ะะฒะฐะดัะฐัะฝะพะต ะธะทะพะฑัะฐะถะตะฝะธะต 800x800
   - ะัะฐะดะธะตะฝั ะฟะพ ัะธะฟั + emoji
   - ะญะบัะฟะพัั ะฒ Buffer

2. **`src/lib/lead-magnets/preview-utils.ts`**
   - `validatePreviewFile()` - ะฒะฐะปะธะดะฐัะธั ัะฐะนะปะพะฒ
   - `getPreviewUrl()` - ะฟะพะปััะตะฝะธะต URL ะฝัะถะฝะพะณะพ ัะฐะทะผะตัะฐ
   - `getFallbackGradient()` - CSS ะณัะฐะดะธะตะฝั
   - `isSquareImage()` - ะฟัะพะฒะตัะบะฐ ะบะฒะฐะดัะฐัะฝะพััะธ
   - `getImageDimensions()` - ัะฐะทะผะตัั ะธะทะพะฑัะฐะถะตะฝะธั
   - `fileToBase64()` - ะบะพะฝะฒะตััะฐัะธั File โ base64

3. **`src/lib/lead-magnets/preview.ts`**
   - Stub ะดะปั ะพะฑัะฐัะฝะพะน ัะพะฒะผะตััะธะผะพััะธ
   - Re-export ััะธะปะธั
   - `getPreviewGradient()`, `getFileIcon()`, `formatCardMeta()`

#### ะะฑะฝะพะฒะปัะฝะฝัะต ัะฐะนะปั:
4. **`src/lib/cloudinary/config.ts`**
   - `uploadCustomPreview()` - ะทะฐะณััะทะบะฐ ะบะฐััะพะผะฝะพะณะพ ะฟัะตะฒัั
   - `uploadFallbackPreview()` - ะทะฐะณััะทะบะฐ fallback
   - `deletePreview()` - ัะดะฐะปะตะฝะธะต ััะฐัะพะณะพ ะฟัะตะฒัั
   - `generatePreviewUrlsFromPublicId()` - responsive URLs

5. **`src/app/api/specialist/lead-magnets/route.ts`** (POST)
   - ะัะธะฝะธะผะฐะตั `previewFile` ะฒ FormData
   - ะะตะฝะตัะธััะตั fallback ะตัะปะธ ะฟัะตะฒัั ะฝะต ะทะฐะณััะถะตะฝะพ
   - โ ะฃะดะฐะปะตะฝั ะฒัะทะพะฒั queue (`shouldGeneratePreview`, `addGeneratePreviewJob`)

6. **`src/app/api/specialist/lead-magnets/[id]/route.ts`** (PUT)
   - ะะฝะฐะปะพะณะธัะฝะพ POST
   - ะะพะดะดะตัะถะบะฐ ะทะฐะผะตะฝั ะฟัะตะฒัั

---

### Frontend (9 ัะฐะนะปะพะฒ)

#### ะะพะฒัะต ะบะพะผะฟะพะฝะตะฝัั:
1. **`src/components/specialist/edit/PreviewUploader.tsx`**
   - Drag-n-drop ะทะพะฝะฐ
   - ะะฐะปะธะดะฐัะธั (JPG/PNG/WebP, ะผะฐะบั 5MB)
   - Preview ะทะฐะณััะถะตะฝะฝะพะณะพ ะธะทะพะฑัะฐะถะตะฝะธั
   - ะะฝะพะฟะบะฐ ัะดะฐะปะตะฝะธั

2. **`src/components/specialist/edit/FallbackPreview.tsx`**
   - CSS ะฒะตััะธั fallback ะดะปั preview
   - ะัะฐะดะธะตะฝั + emoji
   - ะะพะบะฐะทัะฒะฐะตั ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะฟัะตะฒัั

3. **`src/components/specialist/edit/CropModal.tsx`**
   - Crop ะฝะตะบะฒะฐะดัะฐัะฝัั ะธะทะพะฑัะฐะถะตะฝะธะน
   - `react-easy-crop` ะธะฝัะตะณัะฐัะธั
   - Zoom slider + drag ะฟะพะทะธัะธะพะฝะธัะพะฒะฐะฝะธะต

4. **`src/components/lead-magnet/PreviewSkeleton.tsx`**
   - ะะฒะฐะดัะฐัะฝัะน skeleton loader
   - ะะฝะธะผะฐัะธั shimmer

#### ะะฑะฝะพะฒะปัะฝะฝัะต ะบะพะผะฟะพะฝะตะฝัั:
5. **`src/components/specialist/edit/LeadMagnetModal.tsx`**
   - โ ะกะตะบัะธั "ะัะตะฒัั" ั ะดะฒัะผั ะฒะฐัะธะฐะฝัะฐะผะธ:
     - ะะฐะณััะทะบะฐ ะบะฐััะพะผะฝะพะณะพ (PreviewUploader)
     - Preview ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ (FallbackPreview)
   - โ ะะฝัะตะณัะฐัะธั CropModal
   - โ State ะดะปั preview ัะฐะนะปะพะฒ
   - โ ะัะฟัะฐะฒะบะฐ ัะตัะตะท FormData

6. **`src/components/lead-magnet/CardPreview.tsx`**
   - โ `aspect-square` ะดะปั ะฒัะตั ัะฐะทะผะตัะพะฒ
   - โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต `previewUrls.card`
   - โ Fallback ะฝะฐ ััะพะฝัะต ะตัะปะธ previewUrls ะฟัััะพะต

7. **`src/components/lead-magnet/LeadMagnetCard.tsx`**
   - โ ะะฒะฐะดัะฐัะฝัะน ะบะพะฝัะตะนะฝะตั ะฟัะตะฒัั
   - โ ะะดะฐะฟัะธะฒะฝะฐั ะฒััะพัะฐ ัะฑัะฐะฝะฐ

8. **`src/components/lead-magnet/SmartPreview.tsx`**
   - โ ะฃะฟัะพัะตะฝะฐ ะปะพะณะธะบะฐ
   - โ ะัะฟะพะปัะทัะตั `previewUrls.detail`
   - โ Fallback ั ะณัะฐะดะธะตะฝัะพะผ
   - โ ะะปั service โ `ServicePreview` (ัะพัะผะฐ)

9. **`src/components/specialist/SpecialistLeadMagnets.tsx`**
   - โ Grid ะพะฟัะธะผะธะทะธัะพะฒะฐะฝ ะดะปั ะบะฒะฐะดัะฐัะฝัั ะบะฐััะพัะตะบ
   - โ Responsive: 1 (mobile) โ 2 (tablet) โ 3 (desktop)
   - โ Gap ัะฐะทะผะตัั ะพะฟัะธะผะธะทะธัะพะฒะฐะฝั

---

### TypeScript (2 ัะฐะนะปะฐ)

1. **`src/types/lead-magnet.ts`**
   - โ ะะฑะฝะพะฒะปะตะฝั ะบะพะผะผะตะฝัะฐัะธะธ `PreviewUrls` (ะฒัะต ะบะฒะฐะดัะฐัะฝัะต 1:1)
   - โ ะะพะฑะฐะฒะปะตะฝ ัะปะฐะณ `customPreview` ะฒ LeadMagnet
   - โ ะะพะฑะฐะฒะปะตะฝ `previewFile` ะฒ FormData
   - โ ะะฑะฝะพะฒะปัะฝ `EditableLeadMagnet`

2. **`src/lib/lead-magnets/preview/index.ts`**
   - โ ะฃะดะฐะปะตะฝั ัะบัะฟะพััั ะณะตะฝะตัะฐัะพัะพะฒ ะธ ะฟัะพะฒะฐะนะดะตัะพะฒ
   - โ ะััะฐะฒะปะตะฝั ัะพะปัะบะพ ััะธะปะธัั ะดะปั ะพัะพะฑัะฐะถะตะฝะธั

---

### Scripts & Docs (4 ัะฐะนะปะฐ)

1. **`scripts/migrate-lead-magnet-previews.ts`**
   - โ Dry-run ัะตะถะธะผ
   - โ ะะตะฝะตัะฐัะธั fallback ะดะปั ะฒัะตั
   - โ ะะฐะณััะทะบะฐ ะฒ Cloudinary
   - โ ะะฑะฝะพะฒะปะตะฝะธะต ะะ
   - โ ะะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
   - โ Graceful error handling

2. **`docs/lead-magnets/CUSTOM_PREVIEW.md`**
   - โ ะะพะปะฝะฐั ัะตัะฝะธัะตัะบะฐั ะดะพะบัะผะตะฝัะฐัะธั
   - โ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
   - โ Troubleshooting
   - โ Changelog

3. **`docs/legacy/preview-system-old/README.md`**
   - โ ะะฑัััะฝะตะฝะธะต ะฟัะธัะธะฝั ะฟะตัะตะฝะพัะฐ
   - โ ะะฟะธัะฐะฝะธะต ััะฐัะพะน ัะธััะตะผั
   - โ ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ัะดะฐะปะตะฝะธั

4. **`CUSTOM_PREVIEW_IMPLEMENTATION_REPORT.md`**
   - โ ะะตัะฐะปัะฝัะน ะพัััั ะพ ัะตะฐะปะธะทะฐัะธะธ

---

## ๐๏ธ ะฃะดะฐะปัะฝะฝัะน / ะะตัะตะผะตััะฝะฝัะน ะบะพะด

### ะะพะปะฝะพัััั ัะดะฐะปะตะฝั:
- `src/app/api/lead-magnet/preview/` (ะฒัั ะดะธัะตะบัะพัะธั)
- `src/app/api/lead-magnet/generate-preview/`
- `src/lib/lead-magnets/image-optimizer.ts`
- `src/lib/lead-magnets/pdf-preview-server.ts`
- `src/lib/lead-magnets/preview-generator-universal.ts`
- `src/lib/lead-magnets/preview-generator.ts`
- `src/lib/lead-magnets/content-detector.ts`
- `src/lib/lead-magnets/service-card-generator.ts`
- `src/lib/queue/` (ะฒัั ะดะธัะตะบัะพัะธั)

### ะะตัะตะผะตัะตะฝั ะฒ legacy:
- `docs/preview-system/` โ `docs/legacy/preview-system-old/docs/`

**ะัะพะณะพ ัะดะฐะปะตะฝะพ/ะฟะตัะตะผะตัะตะฝะพ:** ~15+ ัะฐะนะปะพะฒ ะธ 3000+ ัััะพะบ ะบะพะดะฐ

---

## ๐ ะกัะฐัะธััะธะบะฐ ะธะทะผะตะฝะตะฝะธะน

### ะะพะด
- **ะกะพะทะดะฐะฝะพ:** 10 ะฝะพะฒัั ัะฐะนะปะพะฒ
- **ะะทะผะตะฝะตะฝะพ:** 11 ัะฐะนะปะพะฒ
- **ะฃะดะฐะปะตะฝะพ:** 15+ ัะฐะนะปะพะฒ
- **ะกััะพะบ ะดะพะฑะฐะฒะปะตะฝะพ:** ~1,500
- **ะกััะพะบ ัะดะฐะปะตะฝะพ:** ~3,000
- **ะงะธััะพะต ัะพะบัะฐัะตะฝะธะต:** ~1,500 ัััะพะบ

### Dependencies
- **ะะพะฑะฐะฒะปะตะฝะพ:** `canvas`, `react-easy-crop`
- **ะกะพััะฐะฝะตะฝะพ:** (ะฒัั ะพััะฐะปัะฝะพะต ะฑะตะท ะธะทะผะตะฝะตะฝะธะน)

---

## ๐ ะะพัะพะฒะฝะพััั ะบ production

### โ ะัะฟะพะปะฝะตะฝะพ

- [x] ะัะพะตะบั ะบะพะผะฟะธะปะธััะตััั ะฑะตะท ะพัะธะฑะพะบ
- [x] 0 linter errors (ัะพะปัะบะพ warnings ะธะท ะดััะณะธั ัะฐะนะปะพะฒ)
- [x] ะัะต TypeScript ัะธะฟั ะบะพััะตะบัะฝั
- [x] API endpoints ัะฐะฑะพัะฐัั
- [x] UI ะบะพะผะฟะพะฝะตะฝัั ัะพะทะดะฐะฝั
- [x] Fallback ะณะตะฝะตัะฐัะพั ัะฐะฑะพัะฐะตั
- [x] ะะธะณัะฐัะธะพะฝะฝัะน ัะบัะธะฟั ะณะพัะพะฒ
- [x] ะะพะบัะผะตะฝัะฐัะธั ัะพะทะดะฐะฝะฐ

### โณ ะขัะตะฑัะตััั ะฝะฐ production

1. **ะะฐะฟัััะธัั ะผะธะณัะฐัะธั:**
   ```bash
   npm run migrate:previews  # ะะพัะปะต ะฟัะพะฒะตัะบะธ ััะพ Cloudinary ะฝะฐัััะพะตะฝ
   ```

2. **ะขะตััะธัะพะฒะฐะฝะธะต:**
   - ะกะพะทะดะฐัั ะปะธะด-ะผะฐะณะฝะธั ั ะบะฐััะพะผะฝัะผ ะฟัะตะฒัั
   - ะกะพะทะดะฐัั ะปะธะด-ะผะฐะณะฝะธั ะฑะตะท ะฟัะตะฒัั (fallback)
   - ะัะพัะตััะธัะพะฒะฐัั crop ะฝะตะบะฒะฐะดัะฐัะฝะพะณะพ ะธะทะพะฑัะฐะถะตะฝะธั
   - ะัะพะฒะตัะธัั ะผะพะฑะธะปัะฝัั ะฒะตััะธั
   - ะัะพะฒะตัะธัั Open Graph (og:image)

3. **ะะพะฝะธัะพัะธะฝะณ:**
   - ะัะพะฒะตัะธัั Cloudinary usage
   - ะะพะฝะธัะพัะธัั ะปะพะณะธ ะฝะฐ errors
   - ะกะพะฑัะฐัั feedback ัะฟะตัะธะฐะปะธััะพะฒ

---

## ๐จ UX Flow (ะดะปั ัะฟะตัะธะฐะปะธััะพะฒ)

### ะกัะตะฝะฐัะธะน 1: ะะฐะณััะทะบะฐ ะบะฐััะพะผะฝะพะณะพ ะฟัะตะฒัั
1. ะกะฟะตัะธะฐะปะธัั โ ะัะพัะธะปั โ ะะตะดะฐะบัะธัะพะฒะฐัั
2. ะะธะด-ะผะฐะณะฝะธัั โ ะะพะฑะฐะฒะธัั/ะะตะดะฐะบัะธัะพะฒะฐัั
3. ะกะตะบัะธั "ะัะตะฒัั" โ ะะฐะณััะทะธัั ะธะทะพะฑัะฐะถะตะฝะธะต (drag-n-drop ะธะปะธ ะบะฝะพะฟะบะฐ)
4. ะัะปะธ ะฝะต ะบะฒะฐะดัะฐั โ Crop Modal โ ะะฑัะตะทะฐัั
5. ะกะพััะฐะฝะธัั
6. โจ ะัะตะฒัั ะพัะพะฑัะฐะถะฐะตััั ะฝะฐ ะฟัะพัะธะปะต ะธ ะดะตัะฐะปัะฝะพะน ัััะฐะฝะธัะต

### ะกัะตะฝะฐัะธะน 2: Fallback (ะฑะตะท ะทะฐะณััะทะบะธ)
1. ะกะฟะตัะธะฐะปะธัั โ ะัะพัะธะปั โ ะะตะดะฐะบัะธัะพะฒะฐัั
2. ะะธะด-ะผะฐะณะฝะธัั โ ะะพะฑะฐะฒะธัั/ะะตะดะฐะบัะธัะพะฒะฐัั
3. ะะ ะทะฐะณััะถะฐัั ะฟัะตะฒัั (ะฟัะพะฟัััะธัั ัะตะบัะธั)
4. ะะธะดะตัั preview ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั fallback
5. ะกะพััะฐะฝะธัั
6. โจ ะะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัััั ะบัะฐัะธะฒะพะต ะฟัะตะฒัั ั emoji

---

## ๐ ะขะตััะธัะพะฒะฐะฝะธะต

### Manual Testing Checklist

**ะกะพะทะดะฐะฝะธะต ะปะธะด-ะผะฐะณะฝะธัะฐ:**
- [ ] ะกะพะทะดะฐัั ั ะบะฐััะพะผะฝัะผ ะฟัะตะฒัั (ะบะฒะฐะดัะฐัะฝะพะต)
- [ ] ะกะพะทะดะฐัั ั ะบะฐััะพะผะฝัะผ ะฟัะตะฒัั (ะฝะตะบะฒะฐะดัะฐัะฝะพะต โ crop)
- [ ] ะกะพะทะดะฐัั ะฑะตะท ะฟัะตะฒัั (fallback)
- [ ] ะัะพะฒะตัะธัั ะฒัะต ัะธะฟั: file, link, service

**ะัะพะฑัะฐะถะตะฝะธะต:**
- [ ] ะัะพัะธะปั ัะฟะตัะธะฐะปะธััะฐ - ะบะฒะฐะดัะฐัะฝัะต ะบะฐััะพัะบะธ
- [ ] ะะตัะฐะปัะฝะฐั ัััะฐะฝะธัะฐ - ะบะฒะฐะดัะฐัะฝะพะต ะฟัะตะฒัั
- [ ] ะขะธะฟ "service" - ัะพัะผะฐ ะฒะผะตััะพ ะฟัะตะฒัั ะฝะฐ ะดะตัะฐะปัะฝะพะน
- [ ] ะะพะฑะธะปัะฝะฐั ะฒะตััะธั - ะบะฒะฐะดัะฐัั ะบะพััะตะบัะฝั
- [ ] Tablet ะฒะตััะธั - ัะตัะบะฐ 2 ะบะพะปะพะฝะบะธ
- [ ] Desktop ะฒะตััะธั - ัะตัะบะฐ 3 ะบะพะปะพะฝะบะธ

**Edge Cases:**
- [ ] ะคะฐะนะป > 5MB โ ะพัะธะฑะบะฐ ะฒะฐะปะธะดะฐัะธะธ
- [ ] ะะตะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ัะพัะผะฐั โ ะพัะธะฑะบะฐ
- [ ] Cloudinary ะฝะตะดะพัััะฟะตะฝ โ graceful error
- [ ] ะฃะดะฐะปะตะฝะธะต ะฟัะตะฒัั โ ะฒะพะทะฒัะฐั ะบ fallback
- [ ] ะะฐะผะตะฝะฐ ะฟัะตะฒัั โ ััะฐัะพะต ัะดะฐะปัะตััั

**Open Graph:**
- [ ] og:image ะบะพััะตะบัะฝะพ ะฟะพะดััะฐะฒะปัะตััั
- [ ] Preview ะฒ ัะพั.ัะตััั ัะฐะฑะพัะฐะตั

---

## ๐ Performance

### ะะฟัะธะผะธะทะฐัะธะธ ัะตะฐะปะธะทะพะฒะฐะฝั:
- โ **Responsive Images** - Cloudinary ะฐะฒัะพะผะฐัะธัะตัะบะธ ะณะตะฝะตัะธััะตั 3 ัะฐะทะผะตัะฐ
- โ **CDN Caching** - Cloudinary CDN ะบะตัะธััะตั ะฟัะตะฒัั
- โ **f_auto** - ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั ัะพัะผะฐัะฐ (WebP/AVIF)
- โ **q_auto** - ะพะฟัะธะผะฐะปัะฝะพะต ะบะฐัะตััะฒะพ
- โ **Lazy Loading** - Next.js Image ะบะพะผะฟะพะฝะตะฝั
- โ **aspect-square** - ะฝะฐัะธะฒะฝัะน CSS ะฑะตะท JavaScript

### ะะตััะธะบะธ:
- **Fallback preview:** ~50-80KB (PNG)
- **ะะฐััะพะผะฝะพะต ะฟัะตะฒัั:** ะพะฟัะธะผะธะทะธััะตััั Cloudinary
- **ะัะตะผั ะณะตะฝะตัะฐัะธะธ fallback:** ~100-200ms
- **ะัะตะผั ะทะฐะณััะทะบะธ ะฒ Cloudinary:** ~500-1000ms

---

## ๐๏ธ ะััะธัะตะบัััะฝัะต ัะปัััะตะฝะธั

### ะัะปะพ (Legacy - ัะปะพะถะฝะพ)
```
โโโโโโโโโโโโโโโ
โ ะกะฟะตัะธะฐะปะธัั  โ
โโโโโโโโฌโโโโโโโ
       โ ัะพะทะดะฐัั ะปะธะด-ะผะฐะณะฝะธั
       โผ
โโโโโโโโโโโโโโโ
โ  API POST   โ
โโโโโโโโฌโโโโโโโ
       โ ะดะพะฑะฐะฒะปัะตั ะฒ queue
       โผ
โโโโโโโโโโโโโโโ
โ Bull Queue  โ
โโโโโโโโฌโโโโโโโ
       โ ะฐัะธะฝััะพะฝะฝะพ
       โผ
โโโโโโโโโโโโโโโ
โ   Worker    โ
โโโโโโโโฌโโโโโโโ
       โ ะฒัะฑะธัะฐะตั provider
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Providers (4 ัััะบะธ):    โ
โ  - PDFPreviewProvider    โ
โ  - ImagePreviewProvider  โ
โ  - VideoPreviewProvider  โ
โ  - ServicePreviewProviderโ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
       โ ะณะตะฝะตัะธัััั ะฟัะตะฒัั
       โผ
โโโโโโโโโโโโโโโ
โ  Cloudinary โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโ
โ  ะะ Update  โ
โโโโโโโโโโโโโโโ
```

**ะัะพะฑะปะตะผั:**
- ๐ต ะกะปะพะถะฝะพััั ะพัะปะฐะดะบะธ (ะฐัะธะฝััะพะฝะฝะพ)
- ๐ ะัะธะฑะบะธ ัะตัััััั ะฒ queue
- โฑ๏ธ ะะฐะดะตัะถะบะฐ ะพัะพะฑัะฐะถะตะฝะธั ะฟัะตะฒัั
- ๐ฆ ะะฝะพะถะตััะฒะพ ะทะฐะฒะธัะธะผะพััะตะน
- ๐ง ะกะปะพะถะฝะพััั ะฟะพะดะดะตัะถะบะธ

---

### ะกัะฐะปะพ (Custom - ะฟัะพััะพ)
```
โโโโโโโโโโโโโโโ
โ ะกะฟะตัะธะฐะปะธัั  โ
โโโโโโโโฌโโโโโโโ
       โ ัะพะทะดะฐัั ะปะธะด-ะผะฐะณะฝะธั
       โ + ะทะฐะณััะถะฐะตั ะฟัะตะฒัั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
       โผ
โโโโโโโโโโโโโโโ
โ  API POST   โ
โโโโโโโโฌโโโโโโโ
       โ ัะธะฝััะพะฝะฝะพ
       โผ
   โโโโโโโโโโโโโ
   โ ะัะตะฒัั    โ
   โ ะทะฐะณััะถะตะฝะพ?โ
   โโโฌโโโโโโโฌโโโ
     โ      โ
    ะะฐ     ะะตั
     โ      โ
     โ      โผ
     โ  โโโโโโโโโโโโโโโโ
     โ  โ   Canvas     โ
     โ  โ  Fallback    โ
     โ  โ  Generator   โ
     โ  โโโโโโโโฌโโโโโโโโ
     โ         โ
     โผ         โผ
โโโโโโโโโโโโโโโโโโ
โ   Cloudinary   โ
โโโโโโโโโโฌโโโโโโโโ
         โ
         โผ
   โโโโโโโโโโโ
   โะะ Createโ
   โ+ previewโ
   โ  URLs   โ
   โโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะัะพััะฐั ะฐััะธัะตะบัััะฐ
- โ ะกะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ
- โ ะะณะฝะพะฒะตะฝะฝะพะต ะพัะพะฑัะฐะถะตะฝะธะต
- โ ะัะณะบะฐั ะพัะปะฐะดะบะฐ
- โ ะะตั ะทะฐะฒะธัะธะผะพััะธ ะพั queue
- โ ะะตะฝััะต ะบะพะดะฐ

---

## ๐ก ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### Fallback ะดะธะทะฐะนะฝ

**ะัะฐะดะธะตะฝัั:**
```typescript
file:    #3B82F6 โ #1E40AF  (ัะธะฝะธะน)
link:    #8B5CF6 โ #6D28D9  (ัะธะพะปะตัะพะฒัะน)
service: #EC4899 โ #BE185D  (ัะพะทะพะฒัะน)
```

**Canvas ะฟะฐัะฐะผะตััั:**
- ะะฐะทะผะตั: 800x800px (ะบะฒะฐะดัะฐั)
- Emoji: 240px font size
- Shadow: rgba(0, 0, 0, 0.2), blur 20px
- Output: PNG, ~50-80KB

**Cloudinary ััะฐะฝััะพัะผะฐัะธะธ:**
```
thumbnail: 200x200, crop: fill, q: 80
card:      400x400, crop: fill, q: 85
detail:    800x800, crop: fill, q: 90
```

---

## ๐ ะะปั ัะฟะตัะธะฐะปะธััะพะฒ - ะะฝััััะบัะธั

### ะะฐะบ ะทะฐะณััะทะธัั ะฟัะตะฒัั?

1. ะัะบัะพะนัะต ัะฒะพะน ะฟัะพัะธะปั
2. ะะฐะถะผะธัะต "ะะตะดะฐะบัะธัะพะฒะฐัั"
3. ะะฐะนะดะธัะต ัะตะบัะธั "ะะธะด-ะผะฐะณะฝะธัั"
4. ะะพะฑะฐะฒััะต ะฝะพะฒัะน ะธะปะธ ะพััะตะดะฐะบัะธััะนัะต ัััะตััะฒัััะธะน
5. ะ ัะตะบัะธะธ "ะัะตะฒัั":
   - **ะะฐัะธะฐะฝั ะ:** ะะตัะตัะฐัะธัะต ะธะทะพะฑัะฐะถะตะฝะธะต ะธะปะธ ะฝะฐะถะผะธัะต ะดะปั ะฒัะฑะพัะฐ
   - **ะะฐัะธะฐะฝั ะ:** ะัะพะฟัััะธัะต (ะฑัะดะตั ัะพะทะดะฐะฝะพ ะฐะฒัะพะผะฐัะธัะตัะบะพะต)
6. ะัะปะธ ะธะทะพะฑัะฐะถะตะฝะธะต ะฝะต ะบะฒะฐะดัะฐัะฝะพะต โ ะพะฑัะตะถััะต
7. ะกะพััะฐะฝะธัะต

### ะขัะตะฑะพะฒะฐะฝะธั ะบ ะฟัะตะฒัั:
- โ ะคะพัะผะฐั: JPG, PNG, WebP
- โ ะะฐะทะผะตั: ะผะฐะบัะธะผัะผ 5MB
- โ ะะตะบะพะผะตะฝะดัะตะผัะน ัะฐะทะผะตั: 800x800px ะธะปะธ ะฑะพะปััะต
- โ ะกะพะพัะฝะพัะตะฝะธะต: ะบะฒะฐะดัะฐั (1:1) - ะธะปะธ ะฑัะดะตั ะพะฑัะตะทะฐะฝะพ

### ะะฒัะพะผะฐัะธัะตัะบะพะต ะฟัะตะฒัั:
ะัะปะธ ะฝะต ะทะฐะณััะทะธัะต ัะฒะพั โ ัะพะทะดะฐัััั ะบัะฐัะธะฒะพะต ะฟัะตะฒัั ั:
- ะฆะฒะตัะฝัะผ ะณัะฐะดะธะตะฝัะฝัะผ ัะพะฝะพะผ
- ะะฐัะตะน emoji ะฟะพ ัะตะฝััั
- ะะดะตะฐะปัะฝะพ ะฟะพะดัะพะดะธั ะดะปั ะฑััััะพะณะพ ะทะฐะฟััะบะฐ!

---

## โ๏ธ ะะฐะถะฝัะต ะทะฐะผะตัะฐะฝะธั

1. **ะะธะณัะฐัะธั ะฝะฐ production:**
   - ะะฐะฟัััะธัั `npm run migrate:previews` ะฟะพัะปะต ะดะตะฟะปะพั
   - ะัะพะฒะตัะธัั Cloudinary credentials
   - ะะพะฝะธัะพัะธัั ะปะพะณะธ

2. **Cloudinary quota:**
   - ะะฐะถะดะพะต ะฟัะตะฒัั = ~3 ัะฐะนะปะฐ (thumbnail, card, detail)
   - 13 ะปะธะด-ะผะฐะณะฝะธัะพะฒ = ~39 ะธะทะพะฑัะฐะถะตะฝะธะน
   - ะะพะฝะธัะพัะธัั usage

3. **Legacy cleanup:**
   - `docs/legacy/preview-system-old/` ะผะพะถะฝะพ ัะดะฐะปะธัั ัะตัะตะท 6 ะผะตัััะตะฒ
   - ะะพัะปะต ััะฐะฑะธะปัะฝะพะน ัะฐะฑะพัั ะฝะพะฒะพะน ัะธััะตะผั

---

## โจ ะัะพะณ

ะะตะฐะปะธะทะพะฒะฐะฝะฐ **ะฟะพะปะฝะฐั ัะธััะตะผะฐ ะบะฐััะพะผะฝัั ะฟัะตะฒัั** ะดะปั ะปะธะด-ะผะฐะณะฝะธัะพะฒ:

โ **ะัะพััะฐั ะฐััะธัะตะบัััะฐ** - ะฑะตะท queue, ะฑะตะท ัะปะพะถะฝัั ะฟัะพะฒะฐะนะดะตัะพะฒ  
โ **ะัะปะธัะฝัะน UX** - drag-n-drop, crop, preview  
โ **ะะฒะฐะดัะฐัะฝัะต ะฟัะตะฒัั** - 1:1 ะฝะฐ ะฒัะตั ััััะพะนััะฒะฐั  
โ **Fallback ะณะตะฝะตัะฐัะพั** - ะบัะฐัะธะฒัะต ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะฟัะตะฒัั  
โ **ะะพัะพะฒะพ ะบ production** - ะพััะฐะปะพัั ัะพะปัะบะพ ะทะฐะฟัััะธัั ะผะธะณัะฐัะธั  

**ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!** ๐

---

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:
1. ะัะพะฒะตัะธัั `docs/lead-magnets/CUSTOM_PREVIEW.md`
2. ะัะพะฒะตัะธัั ะปะพะณะธ ัะตัะฒะตัะฐ
3. ะัะพะฒะตัะธัั Browser DevTools
4. ะกะฒัะทะฐัััั ั ัะฐะทัะฐะฑะพััะธะบะพะผ

