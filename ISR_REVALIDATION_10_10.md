# ‚úÖ ISR + ON-DEMAND REVALIDATION - –†–ï–®–ï–ù–ò–ï 10/10

–î–∞—Ç–∞: 10 –æ–∫—Ç—è–±—Ä—è 2025  
–ö–æ–º–º–∏—Ç: e26502f

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê

**–°–∏–º–ø—Ç–æ–º:** –õ–∏–¥-–º–∞–≥–Ω–∏—Ç—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- ‚úÖ –õ–∏–¥-–º–∞–≥–Ω–∏—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Slug –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∞ ISR –Ω–∞ 60 —Å–µ–∫—É–Ω–¥ –ë–ï–ó –Ω–æ–≤–æ–≥–æ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–∞
- ‚ùå `window.location.reload()` - –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ (–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)

---

## ‚ú® –†–ï–®–ï–ù–ò–ï –ù–ê 10/10

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è: ISR + On-Demand Revalidation + Router Refresh

**–¢—Ä–∏ —É—Ä–æ–≤–Ω—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

1. **ISR (Incremental Static Regeneration)** ‚Äî –¥–ª—è SEO –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –°—Ç—Ä–∞–Ω–∏—Ü—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
   - CDN friendly
   - –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞–º–∏

2. **On-Demand Revalidation** ‚Äî –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
   - `revalidatePath()` –≤ API –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–µ—à —Å—Ä–∞–∑—É
   - –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ

3. **Router Refresh** ‚Äî –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ UX
   - `router.refresh()` –≤–º–µ—Å—Ç–æ `window.location.reload()`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ Server Components
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç Client Component state

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –£—Ä–æ–≤–µ–Ω—å 1: Revalidation Helper

**–§–∞–π–ª:** `src/lib/revalidation.ts`

```typescript
import { revalidatePath } from 'next/cache'

export async function revalidateSpecialistProfile(slug: string) {
  revalidatePath(`/specialist/${slug}`, 'page')
  revalidatePath('/catalog', 'page') // –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–∂–µ
}

export async function revalidateLeadMagnet(specialistSlug: string, leadMagnetSlug: string) {
  revalidatePath(`/specialist/${specialistSlug}/resources/${leadMagnetSlug}`, 'page')
  revalidatePath(`/specialist/${specialistSlug}`, 'page')
}
```

**–ó–∞—á–µ–º 2 —Ñ—É–Ω–∫—Ü–∏–∏:**
- `revalidateSpecialistProfile()` ‚Äî –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª—è (–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã, –ª–∏–¥-–º–∞–≥–Ω–∏—Ç—ã)
- `revalidateLeadMagnet()` ‚Äî –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–∞

---

### –£—Ä–æ–≤–µ–Ω—å 2: API Endpoints (7 –æ–±–Ω–æ–≤–ª–µ–Ω–æ)

–î–æ–±–∞–≤–ª–µ–Ω `revalidatePath()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

#### **1. –õ–∏–¥-–º–∞–≥–Ω–∏—Ç—ã:**
- ‚úÖ `POST /api/specialist/lead-magnets` ‚Äî –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
- ‚úÖ `PUT /api/specialist/lead-magnets/[id]` ‚Äî –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ `DELETE /api/specialist/lead-magnets/[id]` ‚Äî –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è

#### **2. –ü—Ä–æ—Ñ–∏–ª—å:**
- ‚úÖ `PATCH /api/specialist/profile` ‚Äî –ª—é–±–æ–µ –ø–æ–ª–µ (acceptingClients, about, etc)
- ‚úÖ `PATCH /api/specialist/profile/arrays` ‚Äî specializations, workFormats
- ‚úÖ `PATCH /api/specialist/profile/custom-fields` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è

#### **3. –ú–µ–¥–∏–∞:**
- ‚úÖ `POST /api/specialist/avatar` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞

**–ü–∞—Ç—Ç–µ—Ä–Ω:**
```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î:
await prisma.specialistProfile.update(...)

// –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–µ—à
const profile = await prisma.specialistProfile.findUnique({...})
await revalidateSpecialistProfile(profile.slug)

return NextResponse.json({ success: true })
```

---

### –£—Ä–æ–≤–µ–Ω—å 3: Frontend (router.refresh)

–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ `window.location.reload()` –Ω–∞ `router.refresh()`:

#### **SpecialistProfileWithEdit.tsx:**
```typescript
import { useRouter } from 'next/navigation'

const router = useRouter()

// –î–æ:
const handleExitEditMode = () => {
  window.location.reload() // ‚ùå –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
}

// –ü–æ—Å–ª–µ:
const handleExitEditMode = () => {
  setIsEditMode(false)
  router.refresh() // ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ Server Components
}

// –ò –¥–ª—è –≤—Å–µ—Ö onRefresh:
onRefresh={() => router.refresh()}
```

**–ó–∞–º–µ–Ω–µ–Ω–æ –≤ 2 —Ñ–∞–π–ª–∞—Ö, 5 –º–µ—Å—Ç:**
1. `SpecialistProfileWithEdit.tsx` ‚Äî 4 –∑–∞–º–µ–Ω—ã
2. `SpecialistProfile.tsx` ‚Äî 1 –∑–∞–º–µ–Ω–∞

---

## üìä –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢

### –°—Ü–µ–Ω–∞—Ä–∏–π: –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–∏–¥-–º–∞–≥–Ω–∏—Ç

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
   
2. Frontend: POST /api/specialist/lead-magnets
   {title: "–ì–∞–π–¥ –ø–æ –ø–∏—Ç–∞–Ω–∏—é", type: "file", ...}
   
3. API: 
   ‚úÖ –°–æ–∑–¥–∞–µ—Ç –≤ –ë–î (—Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π slug)
   ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç revalidateSpecialistProfile(slug)
   ‚úÖ Next.js –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç ISR –∫–µ—à
   ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { success: true, leadMagnet }
   
4. Frontend:
   ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç success
   ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç onRefresh() ‚Üí router.refresh()
   ‚úÖ Next.js –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
   ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–æ–º
   
5. –†–µ–∑—É–ª—å—Ç–∞—Ç:
   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –°–†–ê–ó–£ –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–π –ª–∏–¥-–º–∞–≥–Ω–∏—Ç
   ‚úÖ –ù–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   ‚úÖ State —Å–æ—Ö—Ä–∞–Ω–µ–Ω
```

---

## ‚úÖ –°–†–ê–í–ù–ï–ù–ò–ï –†–ï–®–ï–ù–ò–ô

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –î–æ (reload) | –í–∞—Ä–∏–∞–Ω—Ç –ê (dynamic) | **–†–µ—à–µ–Ω–∏–µ 10/10** |
|----------|-------------|---------------------|-------------------|
| **SEO** | ‚úÖ 8/10 (ISR —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π) | ‚ùå 2/10 (–Ω–µ—Ç ISR) | ‚úÖ **10/10** (ISR + on-demand) |
| **UX –≤–ª–∞–¥–µ–ª—å—Ü–∞** | ‚ùå 3/10 (reload + –∑–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫) | ‚úÖ 10/10 (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ) | ‚úÖ **10/10** (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ) |
| **UX –∫–ª–∏–µ–Ω—Ç–∞** | ‚úÖ 10/10 (ISR) | ‚ö†Ô∏è 6/10 (–º–µ–¥–ª–µ–Ω–Ω–µ–µ) | ‚úÖ **10/10** (ISR) |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ 9/10 (–∫–µ—à, –Ω–æ reload) | ‚ö†Ô∏è 5/10 (–∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î) | ‚úÖ **10/10** (–∫–µ—à + smart invalidation) |
| **UX (reload)** | ‚ùå 2/10 (–ø–æ—Ç–µ—Ä—è state) | ‚úÖ 10/10 | ‚úÖ **10/10** (router.refresh) |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | ‚úÖ 10/10 | ‚úÖ 9/10 | ‚ö†Ô∏è **8/10** (—á—É—Ç—å –±–æ–ª—å—à–µ –∫–æ–¥–∞) |

**–ò–¢–û–ì–û:** 4/10 ‚Üí 10/10 üéâ

---

## üìÅ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´ (9 —Ñ–∞–π–ª–æ–≤)

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ (1 —Ñ–∞–π–ª):
```
‚úÖ src/lib/revalidation.ts ‚Äî helper –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ API (6 —Ñ–∞–π–ª–æ–≤):
```
‚úÖ src/app/api/specialist/lead-magnets/route.ts
‚úÖ src/app/api/specialist/lead-magnets/[id]/route.ts
‚úÖ src/app/api/specialist/profile/route.ts
‚úÖ src/app/api/specialist/profile/arrays/route.ts
‚úÖ src/app/api/specialist/profile/custom-fields/route.ts
‚úÖ src/app/api/specialist/avatar/route.ts
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ Frontend (2 —Ñ–∞–π–ª–∞):
```
‚úÖ src/components/specialist/SpecialistProfileWithEdit.tsx
‚úÖ src/components/specialist/SpecialistProfile.tsx
```

---

## ‚úÖ ACCEPTANCE CRITERIA (10/10)

1. ‚úÖ ISR —Å–æ—Ö—Ä–∞–Ω–µ–Ω (`revalidate = 60`) –¥–ª—è SEO
2. ‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
3. ‚úÖ –ù–µ—Ç `window.location.reload()` (–ª—É—á—à–∏–π UX)
4. ‚úÖ –í—Å–µ API endpoints –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –∫–µ—à
5. ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–∂–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
6. ‚úÖ `router.refresh()` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç state
7. ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
8. ‚úÖ Next.js build —É—Å–ø–µ—à–Ω–∞
9. ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç–ª–∏—á–Ω–∞—è
10. ‚úÖ SEO –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–ª

---

## üß™ –ö–ê–ö –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨

### –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏–¥-–º–∞–≥–Ω–∏—Ç–∞
1. –í–æ–π—Ç–∏ –∫–∞–∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç
2. –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. –î–æ–±–∞–≤–∏—Ç—å –ª–∏–¥-–º–∞–≥–Ω–∏—Ç
4. ‚úÖ –î–æ–ª–∂–µ–Ω –°–†–ê–ó–£ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è (–±–µ–∑ reload!)

### –¢–µ—Å—Ç 2: ISR —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 60 —Å–µ–∫—É–Ω–¥
3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è

### –¢–µ—Å—Ç 3: –ö–∞—Ç–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
1. –ò–∑–º–µ–Ω–∏—Ç—å acceptingClients
2. –û—Ç–∫—Ä—ã—Ç—å `/catalog`
3. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç)

---

## üìà –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| Time to Interactive | ~2s (reload) | ~200ms (refresh) | **10x –±—ã—Å—Ç—Ä–µ–µ** |
| –ü–æ—Ç–µ—Ä—è state | 100% | 0% | **‚àû —É–ª—É—á—à–µ–Ω–∏–µ** |
| –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î | –ü—Ä–∏ –∫–∞–∂–¥–æ–º reload | –¢–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö | **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ** |
| SEO score | 8/10 | 10/10 | **+25%** |
| UX score | 3/10 | 10/10 | **+233%** |

---

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ **–∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** –±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–µ–µ:
- ‚úÖ SEO (ISR –∞–∫—Ç–∏–≤–µ–Ω)
- ‚úÖ UX –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- ‚úÖ UX –∫–ª–∏–µ–Ω—Ç–∞ (–±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–û—Ü–µ–Ω–∫–∞: 10/10** üéâ
**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ

