
> aura@0.1.0 test:chat
> tsx scripts/test-chat.ts

[dotenv@17.2.3] injecting env (1) from .env.test -- tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`
📝 Loaded config from .env.test
[33m⚠️  ВНИМАНИЕ: Тестируем PRODUCTION API![0m
[36m🌐 URL: https://aura-production-1856.up.railway.app[0m

[36m
╔═══════════════════════════════════════════════╗
║   🧪 АВТОМАТИЧЕСКИЙ ТЕСТ AI ЧАТА              ║
║   Проверка UX-сценариев и логики работы       ║
║   🚀 ТЕСТИРОВАНИЕ PRODUCTION API              ║
╚═══════════════════════════════════════════════╝
[0m
[33m⚠️  ВНИМАНИЕ: Тесты вызывают РЕАЛЬНЫЙ API![0m
[36m🌐 Target: https://aura-production-1856.up.railway.app[0m
[90mСценариев: 5[0m

[90mПроверяем доступность API...[0m
[32m✅ API доступен! (200)[0m


[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[34m📋 Сценарий:[0m Полный цикл подбора психолога
[90mUser отвечает на все вопросы → GPT предлагает кнопку → User нажимает → Получает специалистов[0m
[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[90mSession ID: 2e101767-2550-4279-8c35-a8a792c67e24[0m

[32m👤 User:[0m Помоги найти психолога
[34m🤖 Assistant:[0m Привет! Помогу найти психолога 😊 С чем именно нужна помощь?

[32m👤 User:[0m онлайн
[34m🤖 Assistant:[0m Спасибо за ответ! Какая задача или проблема, с которой вы хотите обратиться к психологу?

[32m👤 User:[0m тревожность и стресс
[34m🤖 Assistant:[0m Понял вас. Какой бюджет планируете на сессию? 

__BUTTONS__["До 2000₽", "До 3000₽", "До 5000₽", "Не важно"]
[33m🔘 Buttons:[0m До 2000₽, До 3000₽, До 5000₽, Не важно

[32m👤 User:[0m до 3000 рублей
[34m🤖 Assistant:[0m Есть предпочтения по методам терапии?

__BUTTONS__["КПТ", "Гештальт", "ACT", "Любые"]
[33m🔘 Buttons:[0m КПТ, Гештальт, ACT, Любые

[32m👤 User:[0m когнитивно-поведенческая терапия
[34m🤖 Assistant:[0m У меня достаточно информации для подбора! Хотите уточнить что-то ещё или начать поиск? 

__BUTTONS__["🔍 Найти специалистов", "Уточнить опыт", "Уточнить ещё"]
[33m🔘 Buttons:[0m 🔍 Найти специалистов, Уточнить опыт, Уточнить ещё

[32m👤 User:[0m 🔍 Найти специалистов
[34m🤖 Assistant:[0m Подбираю психологов для работы с тревожностью и стрессом... Нашёл 2 специалиста, но совпадение с вашим запросом не идеальное (48%). Могу расширить критерии поиска - убрать некоторые фильтры (опыт, цену) для лучшего подбора?

__BUTTONS__["Показать найденных", "Расширить критерии", "Изменить запрос"]
[33m🔘 Buttons:[0m Показать найденных, Расширить критерии, Изменить запрос
[32m👥 Specialists:[0m 2 найдено
   [90m• Наталья Морозова (psychology)[0m
   [90m• Татьяна Петрова (psychology)[0m

[36m🧪 Проверка результатов:[0m
[32m✓[0m shouldSearch: да (факт: да)
[32m✓[0m shouldHaveSpecialists: да (факт: да, найдено: 2)
[32m✓[0m minMessages: >= 12 (факт: 12)

[32m✅ PASSED[0m

[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[34m📋 Сценарий:[0m Быстрый поиск фитнес-тренера
[90mUser сразу указывает все параметры → Умная логика находит на 1-м сообщении[0m
[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[90mSession ID: 9e71b642-e164-4ea7-897e-a861037fa711[0m

[32m👤 User:[0m Найди фитнес тренера онлайн для похудения до 4000 рублей
[34m🤖 Assistant:[0m Привет! Какой тип тренировок вы предпочитаете?  
Силовые", "Кардио", "Функциональные", "Любые"]
[33m🔘 Buttons:[0m Силовые, Кардио, Функциональные, Любые
[32m👥 Specialists:[0m 3 найдено
   [90m• Дмитрий Петров (fitness)[0m
   [90m• Сергей Волков (fitness)[0m

[36m🧪 Проверка результатов:[0m
[32m✓[0m shouldSearch: да (факт: да)
[32m✓[0m shouldHaveSpecialists: да (факт: да, найдено: 3)
[32m✓[0m minMessages: >= 2 (факт: 2)

[32m✅ PASSED[0m

[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[34m📋 Сценарий:[0m Уточнение после первой выдачи
[90mUser получает специалистов → Просит еще → Получает message о новых[0m
[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[90mSession ID: 676b36a0-d51b-4675-81b6-69a264075efe[0m

[32m👤 User:[0m Нужен нутрициолог онлайн
[34m🤖 Assistant:[0m Привет! С удовольствием помогу найти нутрициолога 😊 Какой бюджет планируете на сессию?  
__BUTTONS__["До 2000₽", "До 3000₽", "До 5000₽", "Не важно"]
[33m🔘 Buttons:[0m До 2000₽, До 3000₽, До 5000₽, Не важно

[32m👤 User:[0m похудение
[34m🤖 Assistant:[0m Отлично, цель ясна — похудение. Какой бюджет планируете на сессию?  
__BUTTONS__["До 2000₽", "До 3000₽", "До 5000₽", "Не важно"]
[33m🔘 Buttons:[0m До 2000₽, До 3000₽, До 5000₽, Не важно

[32m👤 User:[0m до 5000
[34m🤖 Assistant:[0m Спасибо! У меня достаточно информации для подбора. Хотите уточнить что-то ещё или начать поиск?  
__BUTTONS__["🔍 Найти специалистов", "Уточнить опыт", "Уточнить ещё"]
[33m🔘 Buttons:[0m 🔍 Найти специалистов, Уточнить опыт, Уточнить ещё

[32m👤 User:[0m 🔍 Найти специалистов
[34m🤖 Assistant:[0m Подбираю нутрициологов для онлайн-консультаций по похудению... Нашёл 2 специалиста, но совпадение с вашим запросом не идеальное (38%). Могу расширить критерии поиска - убрать некоторые фильтры (опыт, цену) для лучшего подбора?  
__BUTTONS__["Показать найденных", "Расширить критерии", "Изменить запрос"]
[33m🔘 Buttons:[0m Показать найденных, Расширить критерии, Изменить запрос
[32m👥 Specialists:[0m 2 найдено
   [90m• Елена Смирнова (nutrition)[0m
   [90m• Мария Соколова (nutrition)[0m

[32m👤 User:[0m Покажи еще варианты
[34m🤖 Assistant:[0m К сожалению, новых специалистов по текущим критериям не найдено. Могу предложить следующие варианты:

1. Показать ранее найденных специалистов ещё раз?
2. Изменить критерии поиска (например, опыт, цена, город)?
3. Посмотреть специалистов из других категорий?
4. Перейти в каталог для самостоятельного выбора?

Что выберете?  
__BUTTONS__["Показать ранее найденных", "Изменить критерии", "Перейти в каталог"]
[33m🔘 Buttons:[0m Показать ранее найденных, Изменить критерии, Перейти в каталог

[36m🧪 Проверка результатов:[0m
[31m✗[0m shouldSearch: да (факт: нет)
[32m✓[0m shouldHaveButtons: да (факт: да)
[32m✓[0m minMessages: >= 10 (факт: 10)

[31m❌ FAILED[0m

[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[34m📋 Сценарий:[0m Расширение критериев при плохих результатах
[90mЕсли не найдено → GPT предлагает расширить → User соглашается[0m
[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[90mSession ID: d936b867-5d3e-4321-8431-7a7a154e83b0[0m

[32m👤 User:[0m Нужен массажист в Минске офлайн с опытом 10 лет до 1000 рублей
[34m🤖 Assistant:[0m Привет! Давайте я помогу вам с поиском массажиста. Уточню, вы хотите массажиста с опытом работы 10 лет или более?

[32m👤 User:[0m 🔍 Найти специалистов
[34m🤖 Assistant:[0m К сожалению, по вашим критериям специалистов не найдено 😔

Вы можете:
1. Расширить критерии, убрав ограничения по опыту или бюджету.
2. Изменить параметры, например, выбрать другой формат или увеличить бюджет.
3. Посмотреть каталог вручную.

__BUTTONS__["Расширить критерии", "Изменить параметры", "Смотреть каталог"]
[33m🔘 Buttons:[0m Расширить критерии, Изменить параметры, Смотреть каталог

[32m👤 User:[0m Расширить критерии
[34m🤖 Assistant:[0m Отлично, попробуем расширить критерии. Хотите убрать ограничение по бюджету или по опыту? Или, возможно, рассмотреть другие варианты?

[36m🧪 Проверка результатов:[0m
[31m✗[0m shouldHaveButtons: да (факт: нет)
[32m✓[0m minMessages: >= 6 (факт: 6)

[31m❌ FAILED[0m

[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[34m📋 Сценарий:[0m Диалог без кнопки поиска
[90mGPT задает вопросы, но User НЕ нажимает кнопку[0m
[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[90mSession ID: 395deadd-cc5c-4c56-b8c6-df2f444f9812[0m

[32m👤 User:[0m Помоги с выбором коуча
[31m❌ Ошибка:[0m Error: API error: 500
    at sendMessage (/Users/mikitavalkunovich/Desktop/Cursor/Аура/scripts/test-chat.ts:164:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async runScenario (/Users/mikitavalkunovich/Desktop/Cursor/Аура/scripts/test-chat.ts:242:22)
    at async main (/Users/mikitavalkunovich/Desktop/Cursor/Аура/scripts/test-chat.ts:370:20)

[36m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[36m📊 ИТОГОВЫЙ ОТЧЕТ[0m

[32m✅ Passed: 2/5[0m
[31m❌ Failed: 3/5[0m

[36mУспешность: 40%[0m

[31m⚠️  ЕСТЬ ПРОВАЛЕННЫЕ ТЕСТЫ![0m

