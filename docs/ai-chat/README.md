# ü§ñ AI-–ß–∞—Ç: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥**
- GPT –≤–µ–¥—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—à–∞–≥–æ–≤–æ (2-3 –≤–æ–ø—Ä–æ—Å–∞)
- –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- –≠–º–ø–∞—Ç–∏—á–Ω—ã–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è

### 2. **Semantic Search (Embeddings)**
- PostgreSQL + pgvector –¥–ª—è vector similarity search
- OpenAI `text-embedding-3-small` (1536 dimensions)
- Hybrid –ø–æ–¥—Ö–æ–¥: keyword fallback –µ—Å–ª–∏ embeddings –Ω–µ –≥–æ—Ç–æ–≤—ã

### 3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ Redis**
- Real-time —Ç—Ä–µ–∫–∏ —Å–æ–±—ã—Ç–∏–π —á–∞—Ç–∞
- –ú–µ—Ç—Ä–∏–∫–∏: —Å–µ—Å—Å–∏–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ–Ω–≤–µ—Ä—Å–∏—è, –∫–ª–∏–∫–∏
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤ PostgreSQL –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

### 4. **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/chat` —Å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–º —á–∞—Ç–æ–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ localStorage + backend
- Streaming responses (—Ç–µ–∫—Å—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –ø–µ—Ä–µ–ø–∏—Å–∫—É
- –ö–Ω–æ–ø–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env.local` –µ—Å—Ç—å:

```env
DATABASE_URL="postgresql://..."
REDIS_URL="redis://..."
OPENAI_API_KEY="sk-proj-..."
```

### –®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç—å pgvector –≤ PostgreSQL

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–π –ë–î –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
npx prisma migrate deploy
```

–ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
npx prisma migrate dev --name add_ai_chat
```

### –®–∞–≥ 4: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å embeddings

```bash
npm run ai:generate-embeddings
```

–≠—Ç–æ –∑–∞–π–º—ë—Ç ~2-5 –º–∏–Ω—É—Ç –¥–ª—è 20 —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤.

### –®–∞–≥ 5: –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000

1. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å AI-–ø–æ–º–æ—â–Ω–∏–∫–∞" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
2. –ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ http://localhost:3000/chat

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞:

1. **"–•–æ—á—É –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–≤–æ–≥–æ–π"**
   - GPT –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç (–æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω)
   - –ó–∞—Ç–µ–º –ø–æ–∫–∞–∑–∞—Ç—å 3-5 –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤

2. **"–ù—É–∂–µ–Ω —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä –¥–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è"**
   - GPT –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç
   - –í–æ–∑–º–æ–∂–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç –ø—Ä–æ –≥–æ—Ä–æ–¥ (–µ—Å–ª–∏ –æ—Ñ—Ñ–ª–∞–π–Ω)
   - –ü–æ–∫–∞–∂–µ—Ç —Ç—Ä–µ–Ω–µ—Ä–æ–≤

3. **"–ò—â—É –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞ –æ–Ω–ª–∞–π–Ω"**
   - GPT –¥–æ–ª–∂–µ–Ω –ø–æ–Ω—è—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —Ñ–æ—Ä–º–∞—Ç —Å—Ä–∞–∑—É
   - –°–ø—Ä–æ—Å–∏—Ç –ø—Ä–æ —Ü–µ–ª—å (–ø–æ—Ö—É–¥–µ–Ω–∏–µ/–Ω–∞–±–æ—Ä –º–∞—Å—Å—ã)
   - –ü–æ–∫–∞–∂–µ—Ç –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

```bash
# –í Redis
redis-cli
KEYS chat:analytics:*
GET chat:analytics:sessions:today:2025-10-06
```

```sql
-- –í PostgreSQL
SELECT * FROM "ChatSession" ORDER BY "createdAt" DESC LIMIT 10;
SELECT * FROM "ChatAnalytics" ORDER BY date DESC LIMIT 5;
```

---

## üìä API Endpoints

### POST /api/chat
–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ —Å GPT.

**Request:**
```json
{
  "messages": [
    {"role": "user", "content": "–•–æ—á—É –ø—Å–∏—Ö–æ–ª–æ–≥–∞"},
    {"role": "assistant", "content": "..."}
  ],
  "sessionId": "uuid"
}
```

**Response:** Streaming text + specialists JSON

### POST /api/embeddings/generate
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.

```json
{
  "specialistId": "clxxx",
  "all": false
}
```

### POST /api/embeddings/search
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ semantic search.

```json
{
  "query": "–ø—Å–∏—Ö–æ–ª–æ–≥ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å",
  "filters": {"category": "psychology"},
  "limit": 10
}
```

---

## üé® –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ chat/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ chat/route.ts         # –û—Å–Ω–æ–≤–Ω–æ–π API
‚îÇ       ‚îî‚îÄ‚îÄ embeddings/
‚îÇ           ‚îú‚îÄ‚îÄ generate/route.ts
‚îÇ           ‚îî‚îÄ‚îÄ search/route.ts
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ chat/
‚îÇ       ‚îú‚îÄ‚îÄ ChatContainer.tsx     # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îÇ       ‚îú‚îÄ‚îÄ ChatMessage.tsx       # –°–æ–æ–±—â–µ–Ω–∏–µ
‚îÇ       ‚îú‚îÄ‚îÄ ChatInput.tsx         # –ü–æ–ª–µ –≤–≤–æ–¥–∞
‚îÇ       ‚îú‚îÄ‚îÄ SpecialistRecommendation.tsx
‚îÇ       ‚îî‚îÄ‚îÄ QuickReplyButtons.tsx
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useChat.ts               # –õ–æ–≥–∏–∫–∞ —á–∞—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ useChatSession.ts        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π
‚îî‚îÄ‚îÄ lib/
    ‚îú‚îÄ‚îÄ ai/
    ‚îÇ   ‚îú‚îÄ‚îÄ openai.ts            # OpenAI –∫–ª–∏–µ–Ω—Ç
    ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.ts        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
    ‚îÇ   ‚îú‚îÄ‚îÄ semantic-search.ts   # Vector search
    ‚îÇ   ‚îî‚îÄ‚îÄ prompts.ts           # System prompts
    ‚îî‚îÄ‚îÄ analytics/
        ‚îî‚îÄ‚îÄ chat-analytics.ts    # Redis —Ç—Ä–µ–∫–∏–Ω–≥
```

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞: "Module not found: Can't resolve 'lucide-react'"

```bash
npm install lucide-react
```

### –û—à–∏–±–∫–∞: "relation SpecialistEmbedding does not exist"

```bash
npx prisma migrate deploy
# –∏–ª–∏
npx prisma db push
```

### GPT –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç / –î–æ–ª–≥–æ –¥—É–º–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ OPENAI_API_KEY
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—É OpenAI API
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: console –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### Embeddings –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ pgvector –≤–∫–ª—é—á–µ–Ω: `SELECT * FROM pg_extension WHERE extname = 'vector';`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ OPENAI_API_KEY
- Rate limits: OpenAI –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç 3000 req/min (tier 1)

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:

1. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –°–∫–æ–ª—å–∫–æ % –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –ø–æ–∫–∞–∑–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤
2. **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π**: ~3-5 –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
3. **–ö–ª–∏–∫–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏**: –°–∫–æ–ª—å–∫–æ % –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º
4. **–í—Ä–µ–º—è –≤ —á–∞—Ç–µ**: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏

### –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å:

```sql
SELECT 
  date,
  "sessionsStarted",
  "completedChats",
  ROUND("completedChats"::numeric / "sessionsStarted" * 100, 2) as conversion_rate,
  "avgMessagesPerSession",
  "profileClicks"
FROM "ChatAnalytics"
ORDER BY date DESC
LIMIT 7;
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **A/B —Ç–µ—Å—Ç—ã**: –†–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø—Ä–æ–º–ø—Ç–æ–≤
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: –ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
3. **–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥**: Web Speech API
4. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ/—É–∫—Ä–∞–∏–Ω—Å–∫–æ–≥–æ
5. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏**: Collaborative filtering

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ production

- [ ] pgvector –≤–∫–ª—é—á–µ–Ω –≤ PostgreSQL
- [ ] –í—Å–µ embeddings —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [ ] OPENAI_API_KEY –¥–æ–±–∞–≤–ª–µ–Ω –≤ Railway Variables
- [ ] Redis –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã 5-10 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (Sentry/LogRocket)

---

–ì–æ—Ç–æ–≤–æ! üöÄ

