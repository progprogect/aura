# üîê –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã "–≠–∫–æ–ª—é—Ü–∏—è 360" —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SMS-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîë –ú–µ—Ç–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ + SMS-–∫–æ–¥** - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
- **Google** - OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **–í–ö–æ–Ω—Ç–∞–∫—Ç–µ** - OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è  
- **–Ø–Ω–¥–µ–∫—Å** - OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **WhatsApp** - —á–µ—Ä–µ–∑ WhatsApp Business API
- **Telegram** - —á–µ—Ä–µ–∑ Telegram Bot API

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Rate limiting (3 SMS –≤ —á–∞—Å –Ω–∞ –Ω–æ–º–µ—Ä)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å-–∞—Ç–∞–∫
- Device fingerprinting
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
- –¢–æ–∫–µ–Ω—ã —Å–µ—Å—Å–∏–π —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º

### üì± UX –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
- –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞ –¥–ª—è SMS
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –ø–æ–ª—è–º–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env.local`:

```env
# SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä
SMSRU_API_ID=your_smsru_api_id

# –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

VK_APP_ID=your_vk_app_id
VK_APP_SECRET=your_vk_app_secret

YANDEX_CLIENT_ID=your_yandex_client_id
YANDEX_CLIENT_SECRET=your_yandex_client_secret

# WhatsApp Business API
WHATSAPP_BUSINESS_ID=your_whatsapp_business_id
WHATSAPP_ACCESS_TOKEN=your_whatsapp_access_token

# Telegram Bot
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_BOT_USERNAME=your_telegram_bot_username

# JWT —Å–µ–∫—Ä–µ—Ç
JWT_SECRET=your_jwt_secret
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞:
- `+79999999999` ‚Üí –∫–æ–¥ `1234`
- `+78888888888` ‚Üí –∫–æ–¥ `5678`  
- `+77777777777` ‚Üí –∫–æ–¥ `9999`
- `+79990000000` ‚Üí –æ—à–∏–±–∫–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### 3. –ó–∞–ø—É—Å–∫

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: http://localhost:3000/auth/register
- –í—Ö–æ–¥: http://localhost:3000/auth/login

## üìã API Endpoints

### POST `/api/auth/send-sms`
–û—Ç–ø—Ä–∞–≤–∫–∞ SMS –∫–æ–¥–∞ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "phone": "+79999999999",
  "purpose": "registration" | "login" | "recovery"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω"
}
```

### POST `/api/auth/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "phone": "+79999999999",
  "code": "1234",
  "provider": "phone"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "specialist": {
    "id": "specialist_id",
    "firstName": "–ù–æ–≤—ã–π",
    "lastName": "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç",
    "phone": "+79999999999",
    "verified": false,
    "subscriptionTier": "FREE"
  },
  "sessionToken": "session_token",
  "isNewUser": true,
  "requiresProfileCompletion": true
}
```

### POST `/api/auth/login`
–í—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "phone": "+79999999999",
  "code": "1234",
  "provider": "phone"
}
```

### GET `/api/auth/profile`
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer session_token
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
```bash
npm run test:auth
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/auth/register`
   - –í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä `+79999999999`
   - –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ `1234`
   - –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

2. **–í—Ö–æ–¥ —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `/auth/login`
   - –í–≤–µ–¥–∏—Ç–µ —Ç–æ—Ç –∂–µ –Ω–æ–º–µ—Ä
   - –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ `1234`
   - –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏:**
   - –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
   - –°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è
   - –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `/api/auth/profile`

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```typescript
// –°–µ—Å—Å–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
model AuthSession {
  id              String   @id @default(cuid())
  specialistId    String
  sessionToken    String   @unique
  deviceFingerprint String?
  userAgent       String?
  ipAddress       String?
  isActive        Boolean  @default(true)
  expiresAt       DateTime
  lastUsedAt      DateTime @default(now())
}

// SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
model SMSVerification {
  id        String   @id @default(cuid())
  phone     String
  code      String
  purpose   String   // "registration" | "login" | "recovery"
  isUsed    Boolean  @default(false)
  attempts  Int      @default(0)
  expiresAt DateTime
}

// –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
model SocialAccount {
  id           String   @id @default(cuid())
  specialistId String
  provider     String   // "google" | "vk" | "yandex" | "whatsapp" | "telegram"
  providerId   String
  email        String?
  name         String?
  picture      String?
  rawData      Json?
  isPrimary    Boolean  @default(false)
  isVerified   Boolean  @default(false)
}
```

### –°–µ—Ä–≤–∏—Å—ã

- **`auth-service.ts`** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **`sms-service.ts`** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ SMS
- **`session-service.ts`** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- **`utils.ts`** - —É—Ç–∏–ª–∏—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
```typescript
const SMS_CONFIG = {
  smsru: {
    apiId: process.env.SMSRU_API_ID,
    baseUrl: 'https://sms.ru/sms/send',
    sender: '–≠–∫–æ–ª—é—Ü–∏—è 360'
  },
  mock: {
    codes: {
      '+79999999999': '1234',
      '+78888888888': '5678'
    }
  }
}
```

### Rate limiting
```typescript
const RATE_LIMITS = {
  smsPerPhone: '3/hour',
  registrationPerIP: '5/hour',
  loginAttempts: '10/hour'
}
```

## üì± –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- Touch-friendly —ç–ª–µ–º–µ–Ω—Ç—ã (–º–∏–Ω–∏–º—É–º 44px)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
- –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

## üöÄ –î–µ–ø–ª–æ–π

### Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. **SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π SMS.ru
2. **Rate limiting:** –í–∫–ª—é—á–∏—Ç–µ —Å—Ç—Ä–æ–≥–∏–µ –ª–∏–º–∏—Ç—ã
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –í–∫–ª—é—á–∏—Ç–µ device fingerprinting
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Railway –¥–µ–ø–ª–æ–π

```bash
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway
SMSRU_API_ID=your_production_api_id
GOOGLE_CLIENT_ID=your_production_client_id
# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —à–∞–≥–∞–º
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ SMS
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–æ–≤
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
// –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
debugLog('–û—Ç–ø—Ä–∞–≤–∫–∞ SMS', { phone, purpose })
debugLog('–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏', { specialistId })
debugLog('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞', { phone, success })
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

1. –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `config.ts`
2. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∏–ø—ã –≤ `types.ts`
3. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `auth-service.ts`
4. –°–æ–∑–¥–∞–π—Ç–µ OAuth endpoint –≤ `api/`

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º

–§–æ—Ä–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `PhoneInput` - –≤–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `SMSCodeInput` - –≤–≤–æ–¥ SMS –∫–æ–¥–∞
- `AuthProviderButtons` - –∫–Ω–æ–ø–∫–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
